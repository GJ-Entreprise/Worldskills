{"config":{"lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Welcome to GJ enterprise documentation website !","title":"Welcome to GJ enterprise documentation website !"},{"location":"#welcome-to-gj-enterprise-documentation-website","text":"","title":"Welcome to GJ enterprise documentation website !"},{"location":"ajouter_documentations/","text":"Ajout_documentations.md Sommaire Ecrire la documentation Pousser sur Github D\u00e9ployer la documentation Requirements Cl\u00e9 publique sur votre compte github (\u00e9viter d'entrer le password \u00e0 chaque commit) Pyhton pip Package mkdocs pip install mkdocs Ecrire la documentation Il faut \u00e9crire la documentation sur la branche master , dans le dossier docs . Pousser sur Github Une fois la documentation \u00e9crite, il faut la pousser sur Github, branche master . git pull git add XXXX.md git commit -m \"ajout doc\" git push Attantion il existe 2 branches : master et gh-deploy . Cette deuxi\u00e8me est utilis\u00e9 par Github pages comme source pour le site web. D\u00e9ployer la documentation sur le site. Sur la m\u00eame branche master , executer la commande : mkdocs gh-deploy Fini.","title":"Ajout_documentations.md"},{"location":"ajouter_documentations/#ajout_documentationsmd","text":"","title":"Ajout_documentations.md"},{"location":"ajouter_documentations/#sommaire","text":"Ecrire la documentation Pousser sur Github D\u00e9ployer la documentation","title":"Sommaire"},{"location":"ajouter_documentations/#requirements","text":"Cl\u00e9 publique sur votre compte github (\u00e9viter d'entrer le password \u00e0 chaque commit) Pyhton pip Package mkdocs pip install mkdocs","title":"Requirements"},{"location":"ajouter_documentations/#ecrire-la-documentation","text":"Il faut \u00e9crire la documentation sur la branche master , dans le dossier docs .","title":"Ecrire la documentation"},{"location":"ajouter_documentations/#pousser-sur-github","text":"Une fois la documentation \u00e9crite, il faut la pousser sur Github, branche master . git pull git add XXXX.md git commit -m \"ajout doc\" git push Attantion il existe 2 branches : master et gh-deploy . Cette deuxi\u00e8me est utilis\u00e9 par Github pages comme source pour le site web.","title":"Pousser sur Github"},{"location":"ajouter_documentations/#deployer-la-documentation-sur-le-site","text":"Sur la m\u00eame branche master , executer la commande : mkdocs gh-deploy Fini.","title":"D\u00e9ployer la documentation sur le site."},{"location":"CentOs/Installer_apache_httpd/","text":"Installation d'un serveur Aapche HTTPD Installation Mettre \u00e0 jour les paquets sudo yum update Installer la paquet httpd sudo yum install httpd Lancer Apache sudo systemctl start httpd Lancer apache au d\u00e9marrage sudo systemctl enable httpd Checker le status sudo systemctl status httpd Ajouter les r\u00e8gles dans la parfeu Par defaut CentOS empeche le traffic entrant vers 80 et 443 sudo firewall-cmd \u2013\u2013permanent \u2013\u2013add-port=80/tcp sudo firewall-cmd \u2013\u2013permanent \u2013\u2013add-port=443/tcp Recharger le par feu pour appliquer les changements sudo firewall-cmd \u2013\u2013reload Done ! Configuration Les fichiers de configuration sont situ\u00e9 : /etc/httpd Le fichier de config principal est situ\u00e9 : /etc/httpd/conf/httpd.conf Les autres fichiers de configurations doivent : se termin\u00e9s par .conf s'inclure dans le fichier de conf principal se situer : /etc/httpd/conf.d/ Il est possible d'ajouter des fonctionnalit\u00e9s \u00e0 apache via des modules : Chemin : /etc/httpd/conf.modules.d/ Logs chemin : /var/log/httpd/ Commandes administration Stopper le service apache sudo systemctl stop httpd D\u00e9marrer le service apache sudo systemctl start httpd Red\u00e9marrer le service apache sudo systemctl restart httpd Lancer apache au d\u00e9marrage sudo systemctl enable httpd Retirer apache au d\u00e9marrage sudo systemctl disable httpd","title":"Installation d'un serveur Aapche HTTPD"},{"location":"CentOs/Installer_apache_httpd/#installation-dun-serveur-aapche-httpd","text":"","title":"Installation d'un serveur Aapche HTTPD"},{"location":"CentOs/Installer_apache_httpd/#installation","text":"Mettre \u00e0 jour les paquets sudo yum update Installer la paquet httpd sudo yum install httpd Lancer Apache sudo systemctl start httpd Lancer apache au d\u00e9marrage sudo systemctl enable httpd Checker le status sudo systemctl status httpd Ajouter les r\u00e8gles dans la parfeu Par defaut CentOS empeche le traffic entrant vers 80 et 443 sudo firewall-cmd \u2013\u2013permanent \u2013\u2013add-port=80/tcp sudo firewall-cmd \u2013\u2013permanent \u2013\u2013add-port=443/tcp Recharger le par feu pour appliquer les changements sudo firewall-cmd \u2013\u2013reload Done !","title":"Installation"},{"location":"CentOs/Installer_apache_httpd/#configuration","text":"Les fichiers de configuration sont situ\u00e9 : /etc/httpd Le fichier de config principal est situ\u00e9 : /etc/httpd/conf/httpd.conf Les autres fichiers de configurations doivent : se termin\u00e9s par .conf s'inclure dans le fichier de conf principal se situer : /etc/httpd/conf.d/ Il est possible d'ajouter des fonctionnalit\u00e9s \u00e0 apache via des modules : Chemin : /etc/httpd/conf.modules.d/ Logs chemin : /var/log/httpd/","title":"Configuration"},{"location":"CentOs/Installer_apache_httpd/#commandes-administration","text":"Stopper le service apache sudo systemctl stop httpd D\u00e9marrer le service apache sudo systemctl start httpd Red\u00e9marrer le service apache sudo systemctl restart httpd Lancer apache au d\u00e9marrage sudo systemctl enable httpd Retirer apache au d\u00e9marrage sudo systemctl disable httpd","title":"Commandes administration"},{"location":"CentOs/apache_TLS_SSL/","text":"Apache / TLS / SSL SSL Secure Socket Layer est un protocol utilis\u00e9 pour s\u00e9curis\u00e9 les traffics sur internet. Utilise une pair de cl\u00e9 priv\u00e9e/publique. Derni\u00e8re version SSLV3 Ce protocol est d\u00e9pr\u00e9ci\u00e9, il ne doit plus \u00eatre utilis\u00e9 ! SSL a \u00e9t\u00e9 remplac\u00e9 par TLS TLS Transport Layer Security Derni\u00e8re version stable : 1.2 La version 1.3 arrive Pour quelle utilit\u00e9 ? SSL et TLS Ont pour but de s\u00e9curis\u00e9 le traffic internet. Toutes les donn\u00e9es qui transient lors d'une requ\u00eate web basique passent en clair par tous les interm\u00e9diaires entre le client et le serveur (les switchs, routeurs, etc). Il faut donc chiffrer ces donn\u00e9es => SSL / TLS TLS requirements Chiffrer les donn\u00e9es \u00e9chang\u00e9es Authentifier au moins un interlocuteur (client/serveur) => assurer l'int\u00e9grit\u00e9 des donn\u00e9es => Eviter les MITMs Eviter les MITM PKI Public Key Infrastructure : L'utilisation de cl\u00e9 publiques, certificats pour authentifier les intelrocuteurs. TLS Toujours utilis\u00e9 la derni\u00e8re version du protocol TLS, une ancienne version expose les donn\u00e9es \u00e0 des failles de s\u00e9curit\u00e9. Apache HTTPD serveur Nous allons voir les fondamentaux pour s\u00e9curis\u00e9 un serveur web Apache.","title":"Apache / TLS / SSL"},{"location":"CentOs/apache_TLS_SSL/#apache-tls-ssl","text":"","title":"Apache / TLS / SSL"},{"location":"CentOs/apache_TLS_SSL/#ssl","text":"Secure Socket Layer est un protocol utilis\u00e9 pour s\u00e9curis\u00e9 les traffics sur internet. Utilise une pair de cl\u00e9 priv\u00e9e/publique. Derni\u00e8re version SSLV3 Ce protocol est d\u00e9pr\u00e9ci\u00e9, il ne doit plus \u00eatre utilis\u00e9 !","title":"SSL"},{"location":"CentOs/apache_TLS_SSL/#ssl-a-ete-remplace-par-tls","text":"","title":"SSL a \u00e9t\u00e9 remplac\u00e9 par TLS"},{"location":"CentOs/apache_TLS_SSL/#tls","text":"Transport Layer Security Derni\u00e8re version stable : 1.2 La version 1.3 arrive","title":"TLS"},{"location":"CentOs/apache_TLS_SSL/#pour-quelle-utilite","text":"SSL et TLS Ont pour but de s\u00e9curis\u00e9 le traffic internet. Toutes les donn\u00e9es qui transient lors d'une requ\u00eate web basique passent en clair par tous les interm\u00e9diaires entre le client et le serveur (les switchs, routeurs, etc). Il faut donc chiffrer ces donn\u00e9es => SSL / TLS","title":"Pour quelle utilit\u00e9 ?"},{"location":"CentOs/apache_TLS_SSL/#tls-requirements","text":"Chiffrer les donn\u00e9es \u00e9chang\u00e9es Authentifier au moins un interlocuteur (client/serveur) => assurer l'int\u00e9grit\u00e9 des donn\u00e9es => Eviter les MITMs","title":"TLS requirements"},{"location":"CentOs/apache_TLS_SSL/#eviter-les-mitm","text":"","title":"Eviter les MITM"},{"location":"CentOs/apache_TLS_SSL/#pki","text":"Public Key Infrastructure : L'utilisation de cl\u00e9 publiques, certificats pour authentifier les intelrocuteurs.","title":"PKI"},{"location":"CentOs/apache_TLS_SSL/#tls_1","text":"Toujours utilis\u00e9 la derni\u00e8re version du protocol TLS, une ancienne version expose les donn\u00e9es \u00e0 des failles de s\u00e9curit\u00e9.","title":"TLS"},{"location":"CentOs/apache_TLS_SSL/#apache-httpd-serveur","text":"Nous allons voir les fondamentaux pour s\u00e9curis\u00e9 un serveur web Apache.","title":"Apache HTTPD serveur"},{"location":"CentOs/creation_compte_utilisateurs/","text":"Cr\u00e9ation de compte utilisateur","title":"Cr\u00e9ation de compte utilisateur"},{"location":"CentOs/creation_compte_utilisateurs/#creation-de-compte-utilisateur","text":"","title":"Cr\u00e9ation de compte utilisateur"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/","text":"S\u00e9curiser - CDP et LLDP : 0 Le laboratoire : Voici le laboratoire que j'utilise pour tester la s\u00e9curit\u00e9 des protocoles CDP et LLDP : Adressage MAC : * KALI ; 00:0C:29:05:A1:31 * SW-1 ; 0C:44:BE:18:8F:00 1 Le protocole CDP : 1.1 Activer CDP : Par CDP est actif sur tous les ports d'un equipements Cisco, mais il est possible de l'activer comme ceci : SW-1(config)# cdp run Ou uniquement de l'activer sur une interface : SW-1(config)# interface GigabitEthernet 0/0 SW-1(config)# cdp enable 1.2 D\u00e9sactiver CDP : Pour d\u00e9sactiver CDP globalement : SW-1(config)# no cdp run Ou le d\u00e9sactiver sur un ou des port(s) sp\u00e9cifique(s) : SW-1(config)# interface GigabitEthernet 0/0 SW-1(config)# no cdp enable 1.3 Voir les voisins CDP depuis Kali : Depuis la VM KALI, utilisation de Wireshark avec le filtre cdp : 1.4 Voir les voisins CDP depuis Cisco : Sur un switch Cisco pour voir les voisins : SW-1# show cdp neighbors detail 2 Le protocole LLDP : 2.1 Activer LLDP : Le protocole LLDP n'est pas par d\u00e9faut actif sur les \u00e9quipements Cisco, mais il est possible de l'activer comme ceci : SW-1(config)# lldp run Ou uniquement de l'activer sur une interface : SW-1(config)# interface GigabitEthernet 0/0 SW-1(config)# lldp transmit 1.2 D\u00e9sactiver LLDP : Pour d\u00e9sactiver LLDP globalement : SW-1(config)# no lldp run Ou le d\u00e9sactiver sur un ou des port(s) sp\u00e9cifique(s) : SW-1(config)# interface GigabitEthernet 0/0 SW-1(config)# no lldp transmit 1.3 Voir les voisins LLDP depuis Kali : Depuis la VM KALI, utilisation de Wireshark avec le filtre lldp : 1.4 Voir les voisins LLDP depuis Cisco : Sur un switch Cisco pour voir les voisins : SW-1# show lldp neighbors detail","title":"S\u00e9curiser - CDP et LLDP :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#securiser-cdp-et-lldp","text":"","title":"S\u00e9curiser - CDP et LLDP :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#0-le-laboratoire","text":"Voici le laboratoire que j'utilise pour tester la s\u00e9curit\u00e9 des protocoles CDP et LLDP : Adressage MAC : * KALI ; 00:0C:29:05:A1:31 * SW-1 ; 0C:44:BE:18:8F:00","title":"0 Le laboratoire :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#1-le-protocole-cdp","text":"","title":"1 Le protocole CDP :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#11-activer-cdp","text":"Par CDP est actif sur tous les ports d'un equipements Cisco, mais il est possible de l'activer comme ceci : SW-1(config)# cdp run Ou uniquement de l'activer sur une interface : SW-1(config)# interface GigabitEthernet 0/0 SW-1(config)# cdp enable","title":"1.1 Activer CDP :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#12-desactiver-cdp","text":"Pour d\u00e9sactiver CDP globalement : SW-1(config)# no cdp run Ou le d\u00e9sactiver sur un ou des port(s) sp\u00e9cifique(s) : SW-1(config)# interface GigabitEthernet 0/0 SW-1(config)# no cdp enable","title":"1.2 D\u00e9sactiver CDP :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#13-voir-les-voisins-cdp-depuis-kali","text":"Depuis la VM KALI, utilisation de Wireshark avec le filtre cdp :","title":"1.3 Voir les voisins CDP depuis Kali :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#14-voir-les-voisins-cdp-depuis-cisco","text":"Sur un switch Cisco pour voir les voisins : SW-1# show cdp neighbors detail","title":"1.4 Voir les voisins CDP depuis Cisco :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#2-le-protocole-lldp","text":"","title":"2 Le protocole LLDP :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#21-activer-lldp","text":"Le protocole LLDP n'est pas par d\u00e9faut actif sur les \u00e9quipements Cisco, mais il est possible de l'activer comme ceci : SW-1(config)# lldp run Ou uniquement de l'activer sur une interface : SW-1(config)# interface GigabitEthernet 0/0 SW-1(config)# lldp transmit","title":"2.1 Activer LLDP :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#12-desactiver-lldp","text":"Pour d\u00e9sactiver LLDP globalement : SW-1(config)# no lldp run Ou le d\u00e9sactiver sur un ou des port(s) sp\u00e9cifique(s) : SW-1(config)# interface GigabitEthernet 0/0 SW-1(config)# no lldp transmit","title":"1.2 D\u00e9sactiver LLDP :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#13-voir-les-voisins-lldp-depuis-kali","text":"Depuis la VM KALI, utilisation de Wireshark avec le filtre lldp :","title":"1.3 Voir les voisins LLDP depuis Kali :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#14-voir-les-voisins-lldp-depuis-cisco","text":"Sur un switch Cisco pour voir les voisins : SW-1# show lldp neighbors detail","title":"1.4 Voir les voisins LLDP depuis Cisco :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/","text":"S\u00e9curiser - ARP et DHCP : 0 Le laboratoire : Voici le laboratoire que j'utilise pour tester la s\u00e9curit\u00e9 des protocoles DHCP et ARP : Adressage IP et MAC : * PC-1 ; DHCP ; 00:50:79:66:68:00 * PC-2 ; DHCP ; 00:50:79:66:68:01 * DHCP ; 192.168.10.31/24 ; 00:0C:29:07:DB:B1 * KALI ; DHCP ; 00:0C:29:05:A1:31 * SW-1 ; 192.168.10.1/24 ; // Tous les h\u00f4tes sont dans le vlan 1. Configuration du serveur DHCP : option domain-name \"example.org\"; option domain-name-servers ns1.example.org, ns2.example.org; defauylt-lease-time 600; max-lease-time 7200; subnet 192.168.10.0 netmask 255.255.255.0 { range 192.168.10.100 192.168.10.120; option subnet-mask 255.255.255.0; option broadcast-address 192.168.10.255; } 1 S\u00e9curiser le protocole DHCP : Ressource : * https://formip.com/dhcp-snooping/ * https://medium.com/@ayushir/dhcp-snooping-attack-ca728e4dd84 Attaque sur le protocole DHCP : * Une r\u00e9servation totale des baux DHCP du vrai serveur DHCP, (DHCP Starvation) * Une distribution de DHCP Offer avec l'@IP de passerelle l'IP du rogue DHCP, (DHCP Spoofing) Cisco \u00e0 mis en place la fonction DHCP snooping, cette fonctionalit\u00e9 bloque toutes les trames DHCP Offer si elles ne proviennent pas d'un port trust sur le switch. 1.1 Mise en place du DHCP snooping : Mise en place du DHCP snooping : 1. SW-1(config)# ip dhcp snooping 2. SW-1(config)# ip dhcp snooping vlan 1 3. SW-1(config)# no ip dhcp snooping information option Activation du DHCP snooping globalement. Activation du DHCP snooping sur le vlan 1, \u00e9tape n\u00e9cessaire sans celle-ci le DHCP snooping n'est pas fonctionnel. Commande optionnel, l'activation globale du DHCP snooping active l'option DHCP 82. Cette option sp\u00e9cifie le r\u00e9seau cible de demande (cela sert dans le DHCP relai pour que le serveur toruve le pool associ\u00e9). Certain serveur DHCP n'appr\u00e9cie pas cette option. C'est pourquoi il faut peut \u00eatre la desactiver. Trust du port Gi3/1 du switch car le serveur vrai serveur DHCP est connect\u00e9 dessus : SW-1(config)# interface GigabitEthernet 3/1 SW-1(config-if)# ip dhcp snooping trust SW-1(config-if)# ip dhcp snooping limit rate 80 S\u00e9lection de l'interface, Trust de l'interface Mise en place d'un quota, dans l'exemple ce port est limit\u00e9 \u00e0 80 requ\u00eates DHCP/secondes. Mise en place du port security pour \u00e9viter que le serveur DHCP n'est plus de baux a proposer. PC-1 : SW-1(config)# interface GigabitEthernet 1/1 SW-1(config-if)# switchport mode access SW-1(config-if)# switchport port-security SW-1(config-if)# switchport port-security max 3 SW-1(config-if)# switchport port-security violation shutdown SW-1(config-if)# exit PC-2 : SW-1(config)# interface GigabitEthernet 1/2 SW-1(config-if)# switchport mode access SW-1(config-if)# switchport port-security max 3 SW-1(config-if)# switchport port-security violation shutdown SW-1(config-if)# exit KALI : SW-1(config)# interface GigabitEthernet 2/1 SW-1(config-if)# switchport mode access SW-1(config-if)# switchport port-security max 3 SW-1(config-if)# switchport port-security violation shutdown SW-1(config-if)# exit Si il y a plus de trois adresse MAC associ\u00e9 \u00e0 un port dans la table CAM du switch le port en question est \u00e9teint (shutdown). Cette limitation permet de \"voler\" au maximum 3 baux par le pirate (DHCP Starvation) ce qui \u00e9vite un DoS des configurations IP. 1.2 V\u00e9rification du DHCP snooping : Commandes pour v\u00e9rifier le DHCP snooping : SW-1# show ip dhcp snooping Il est possible de noter que l'option 82 est d\u00e9sactiv\u00e9 et que l'interface Gi3/1 est une interface trust par le switch pour les trames DHCP Offer. Commandes pour voir le cache des trames DHCP : SW-1# show ip dhcp snooping binding Dans cette capture il est possible de voir que le DHCP \u00e0 distribu\u00e9 trois baux DHCP, on y retrouve : * @MAC du client, * @IP distribu\u00e9 par le DHCP, * Lease time du bail DHCP, * Interface du client, Il est possible de clear ce cache : SW-1# clear ip dhcp snooping binding * Enfin pour le port-security : SW-1# show port-security Nous pouvons remarquer que le port security permet \u00e0 chaque port 3 adresse MAC diff\u00e9rentes. Une adresse MAC est d\u00e9ja utilis\u00e9 sur chaque port il en reste donc deux de disponible. 1.3 Tentative d'attaque : 1.3.1 DHCP Starvation : Pour rappel le port security est actif est configurer pour autoriser 3 adresse MAC diff\u00e9rentes sur chaque port du switch. Utilisation de yersinia, depuis la VM KALI : yersinia -G Apr\u00e8s un cours instant, la VM KALI r\u00e9alise un nombre infinie de requ\u00eate DHCP Discover dans l'objectif d'utiliser tous les baux DHCP du serveur DHCP. Mais le port security limite \u00e0 un maximum de 3 adresse MAC sur le port de la KALI (donc 3 demande DHCP Discover), ce qui \u00e0 pour cons\u00e9quence de placer le port en mode err-disabled et de le shutdown. Aper\u00e7u : SW-1# show port-security SW-1# show interface status Afin de placer cette interface en status up : SW-1(config)# interface GigabitEthernet 2/1 SW-1(config-if)# shutdown SW-1(config-if)# no shutdown 1.3.2 DHCP Spoofing : Pour rappel seul le port vers le serveur DHCP (GigabitEthernet 3/1) est trust pour les trames DHCP Offer. Utilisation de ethercap, depuis la VM KALI : ettercap -G Afin de donner d'obtenir de meilleur r\u00e9sultat, je stop le service DHCP du serveur DHCP : /etc/init.d/isc-dhcp-server stop Les clients n'arrive pas \u00e0 obtenir des requ\u00eates DHCP car les trames de demande de bail DHCP sont uniquement envoy\u00e9 sur les ports trusts. Mais par exemple si je place l'interface de la VM KALI en mode trust : SW-1(config)# interface GigabitEthernet 2/1 SW-1(config-if)# ip dhcp snooping trust Et que depuis PC-1 et PC-2 je renouvelle ma demande de bail DHCP alors j'obtiens une configuration IP : PC-1> ip dhcp PC-2> ip dhcp Depuis Ethercap : Configuration IP des postes : PC-1> show ip La VM Kali est devenus la Gateway sur les postes. Mais sans la modification du switch pour trust le port de la KALI, les clients n'aurai jamais obtenu cette configuration IP. 2 S\u00e9curiser le protocole ARP : Ressource : * https://formip.com/dai/ Pour s\u00e9curiser le protocole ARP, il est possible de s'appuyer sur la fonctionalit\u00e9 DHCP snooping. En effet cette fonctionalit\u00e9 construit une table (que l'on peux consulter avec la commande : show ip dhcp snooping binding Au sein des switchs Cisco il existe la fonctionalit\u00e9 Dynamic ARP Inspection (DAI). Pour valider qu'un h\u00f4te \u00e0 l'IP qu'il pr\u00e9tend avoir, le switch v\u00e9rifie son association @MAC et @IP dans la table du DHCP snooping. 2.1 Mise en place du DAI : Pour mettre en place DAI : Switch(config)# ip arp inspection vlan 1 Toutes les trames qui circulent sont analys\u00e9s sur l'adresse MAC et l'adresse IP. Si l'association MAC <-> IP n'est pas r\u00e9f\u00e9renc\u00e9 dans la table snooping binding, le switch drop la trame. Cal fonctionne pour les postes qui utilise le DHCP et qui sont r\u00e9renc\u00e9 dans cette table, mais pour les postes qui utilisent des configurtaion IP statique, le switch va dropper les trames car l'association MAC <-> IP n'est pas r\u00e9f\u00e9renc\u00e9. Pour cela il est possible de trust un port ou un poste est configur\u00e9 avec une IP fixe, ce qui est le cas du port GigabitEthernet3/1 ou le serveur DHCP est connect\u00e9 : Switch(config)# interface GigabitEthernet 3/1 Switch(config-if)# ip arp inspection trust 2.2 Tentative d'attaque : Depuis KALI je vais tenter d'empoisoner la table ARP de PC-1 pour me faire passer pour PC-2, la table ARP de PC-1 est actuellement vide. Pour rappel : * PC-1 : 00:50:79:66:68:00, 192.168.10.118 * PC-2 : 00:50:79:66:68:01, 192.168.10.120 * KALI : 00:0C:29:05:A1:31, 192.168.10.104 Depuis KALI : arpspoof -t 192.168.10.118 192.168.10.120 Traduction litt\u00e9rale : Aupr\u00e8s de PC-1 (192.168.10.118) fait moi passer pour PC-2 (192.168.10.120). Sur le poste le cache ARP est vide : PC-1> show arp Mais depuis le switch (SW-1), il est possible d'observer ces lignes de logs : Le switch a d\u00e9tecter que KALI envoie des r\u00e9ponses ARP falsifi\u00e9s car cette association (MAC <-> IP ) n'est pas pr\u00e9sente : * Dans le cache DHCP snooping, * Le port n'a pas \u00e9t\u00e9 d\u00e9finis en trust donc cette association n'est pas pris en compte par le switch, 3 Conclusion : Pour conclure sur la s\u00e9curit\u00e9 des protocoles : * Attaque DHCP Starvation -> Port Security, * Attaque DHCP Spoofing -> DHCP Snooping, * Attaque ARP Spoofing -> DAI avec DHCP Snooping,","title":"S\u00e9curiser - ARP et DHCP :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#securiser-arp-et-dhcp","text":"","title":"S\u00e9curiser - ARP et DHCP :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#0-le-laboratoire","text":"Voici le laboratoire que j'utilise pour tester la s\u00e9curit\u00e9 des protocoles DHCP et ARP : Adressage IP et MAC : * PC-1 ; DHCP ; 00:50:79:66:68:00 * PC-2 ; DHCP ; 00:50:79:66:68:01 * DHCP ; 192.168.10.31/24 ; 00:0C:29:07:DB:B1 * KALI ; DHCP ; 00:0C:29:05:A1:31 * SW-1 ; 192.168.10.1/24 ; // Tous les h\u00f4tes sont dans le vlan 1. Configuration du serveur DHCP : option domain-name \"example.org\"; option domain-name-servers ns1.example.org, ns2.example.org; defauylt-lease-time 600; max-lease-time 7200; subnet 192.168.10.0 netmask 255.255.255.0 { range 192.168.10.100 192.168.10.120; option subnet-mask 255.255.255.0; option broadcast-address 192.168.10.255; }","title":"0 Le laboratoire :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#1-securiser-le-protocole-dhcp","text":"Ressource : * https://formip.com/dhcp-snooping/ * https://medium.com/@ayushir/dhcp-snooping-attack-ca728e4dd84 Attaque sur le protocole DHCP : * Une r\u00e9servation totale des baux DHCP du vrai serveur DHCP, (DHCP Starvation) * Une distribution de DHCP Offer avec l'@IP de passerelle l'IP du rogue DHCP, (DHCP Spoofing) Cisco \u00e0 mis en place la fonction DHCP snooping, cette fonctionalit\u00e9 bloque toutes les trames DHCP Offer si elles ne proviennent pas d'un port trust sur le switch.","title":"1 S\u00e9curiser le protocole DHCP :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#11-mise-en-place-du-dhcp-snooping","text":"Mise en place du DHCP snooping : 1. SW-1(config)# ip dhcp snooping 2. SW-1(config)# ip dhcp snooping vlan 1 3. SW-1(config)# no ip dhcp snooping information option Activation du DHCP snooping globalement. Activation du DHCP snooping sur le vlan 1, \u00e9tape n\u00e9cessaire sans celle-ci le DHCP snooping n'est pas fonctionnel. Commande optionnel, l'activation globale du DHCP snooping active l'option DHCP 82. Cette option sp\u00e9cifie le r\u00e9seau cible de demande (cela sert dans le DHCP relai pour que le serveur toruve le pool associ\u00e9). Certain serveur DHCP n'appr\u00e9cie pas cette option. C'est pourquoi il faut peut \u00eatre la desactiver. Trust du port Gi3/1 du switch car le serveur vrai serveur DHCP est connect\u00e9 dessus : SW-1(config)# interface GigabitEthernet 3/1 SW-1(config-if)# ip dhcp snooping trust SW-1(config-if)# ip dhcp snooping limit rate 80 S\u00e9lection de l'interface, Trust de l'interface Mise en place d'un quota, dans l'exemple ce port est limit\u00e9 \u00e0 80 requ\u00eates DHCP/secondes. Mise en place du port security pour \u00e9viter que le serveur DHCP n'est plus de baux a proposer. PC-1 : SW-1(config)# interface GigabitEthernet 1/1 SW-1(config-if)# switchport mode access SW-1(config-if)# switchport port-security SW-1(config-if)# switchport port-security max 3 SW-1(config-if)# switchport port-security violation shutdown SW-1(config-if)# exit PC-2 : SW-1(config)# interface GigabitEthernet 1/2 SW-1(config-if)# switchport mode access SW-1(config-if)# switchport port-security max 3 SW-1(config-if)# switchport port-security violation shutdown SW-1(config-if)# exit KALI : SW-1(config)# interface GigabitEthernet 2/1 SW-1(config-if)# switchport mode access SW-1(config-if)# switchport port-security max 3 SW-1(config-if)# switchport port-security violation shutdown SW-1(config-if)# exit Si il y a plus de trois adresse MAC associ\u00e9 \u00e0 un port dans la table CAM du switch le port en question est \u00e9teint (shutdown). Cette limitation permet de \"voler\" au maximum 3 baux par le pirate (DHCP Starvation) ce qui \u00e9vite un DoS des configurations IP.","title":"1.1 Mise en place du DHCP snooping :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#12-verification-du-dhcp-snooping","text":"Commandes pour v\u00e9rifier le DHCP snooping : SW-1# show ip dhcp snooping Il est possible de noter que l'option 82 est d\u00e9sactiv\u00e9 et que l'interface Gi3/1 est une interface trust par le switch pour les trames DHCP Offer. Commandes pour voir le cache des trames DHCP : SW-1# show ip dhcp snooping binding Dans cette capture il est possible de voir que le DHCP \u00e0 distribu\u00e9 trois baux DHCP, on y retrouve : * @MAC du client, * @IP distribu\u00e9 par le DHCP, * Lease time du bail DHCP, * Interface du client, Il est possible de clear ce cache : SW-1# clear ip dhcp snooping binding * Enfin pour le port-security : SW-1# show port-security Nous pouvons remarquer que le port security permet \u00e0 chaque port 3 adresse MAC diff\u00e9rentes. Une adresse MAC est d\u00e9ja utilis\u00e9 sur chaque port il en reste donc deux de disponible.","title":"1.2 V\u00e9rification du DHCP snooping :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#13-tentative-dattaque","text":"","title":"1.3 Tentative d'attaque :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#131-dhcp-starvation","text":"Pour rappel le port security est actif est configurer pour autoriser 3 adresse MAC diff\u00e9rentes sur chaque port du switch. Utilisation de yersinia, depuis la VM KALI : yersinia -G Apr\u00e8s un cours instant, la VM KALI r\u00e9alise un nombre infinie de requ\u00eate DHCP Discover dans l'objectif d'utiliser tous les baux DHCP du serveur DHCP. Mais le port security limite \u00e0 un maximum de 3 adresse MAC sur le port de la KALI (donc 3 demande DHCP Discover), ce qui \u00e0 pour cons\u00e9quence de placer le port en mode err-disabled et de le shutdown. Aper\u00e7u : SW-1# show port-security SW-1# show interface status Afin de placer cette interface en status up : SW-1(config)# interface GigabitEthernet 2/1 SW-1(config-if)# shutdown SW-1(config-if)# no shutdown","title":"1.3.1 DHCP Starvation :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#132-dhcp-spoofing","text":"Pour rappel seul le port vers le serveur DHCP (GigabitEthernet 3/1) est trust pour les trames DHCP Offer. Utilisation de ethercap, depuis la VM KALI : ettercap -G Afin de donner d'obtenir de meilleur r\u00e9sultat, je stop le service DHCP du serveur DHCP : /etc/init.d/isc-dhcp-server stop Les clients n'arrive pas \u00e0 obtenir des requ\u00eates DHCP car les trames de demande de bail DHCP sont uniquement envoy\u00e9 sur les ports trusts. Mais par exemple si je place l'interface de la VM KALI en mode trust : SW-1(config)# interface GigabitEthernet 2/1 SW-1(config-if)# ip dhcp snooping trust Et que depuis PC-1 et PC-2 je renouvelle ma demande de bail DHCP alors j'obtiens une configuration IP : PC-1> ip dhcp PC-2> ip dhcp Depuis Ethercap : Configuration IP des postes : PC-1> show ip La VM Kali est devenus la Gateway sur les postes. Mais sans la modification du switch pour trust le port de la KALI, les clients n'aurai jamais obtenu cette configuration IP.","title":"1.3.2 DHCP Spoofing :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#2-securiser-le-protocole-arp","text":"Ressource : * https://formip.com/dai/ Pour s\u00e9curiser le protocole ARP, il est possible de s'appuyer sur la fonctionalit\u00e9 DHCP snooping. En effet cette fonctionalit\u00e9 construit une table (que l'on peux consulter avec la commande : show ip dhcp snooping binding Au sein des switchs Cisco il existe la fonctionalit\u00e9 Dynamic ARP Inspection (DAI). Pour valider qu'un h\u00f4te \u00e0 l'IP qu'il pr\u00e9tend avoir, le switch v\u00e9rifie son association @MAC et @IP dans la table du DHCP snooping.","title":"2 S\u00e9curiser le protocole ARP :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#21-mise-en-place-du-dai","text":"Pour mettre en place DAI : Switch(config)# ip arp inspection vlan 1 Toutes les trames qui circulent sont analys\u00e9s sur l'adresse MAC et l'adresse IP. Si l'association MAC <-> IP n'est pas r\u00e9f\u00e9renc\u00e9 dans la table snooping binding, le switch drop la trame. Cal fonctionne pour les postes qui utilise le DHCP et qui sont r\u00e9renc\u00e9 dans cette table, mais pour les postes qui utilisent des configurtaion IP statique, le switch va dropper les trames car l'association MAC <-> IP n'est pas r\u00e9f\u00e9renc\u00e9. Pour cela il est possible de trust un port ou un poste est configur\u00e9 avec une IP fixe, ce qui est le cas du port GigabitEthernet3/1 ou le serveur DHCP est connect\u00e9 : Switch(config)# interface GigabitEthernet 3/1 Switch(config-if)# ip arp inspection trust","title":"2.1 Mise en place du DAI :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#22-tentative-dattaque","text":"Depuis KALI je vais tenter d'empoisoner la table ARP de PC-1 pour me faire passer pour PC-2, la table ARP de PC-1 est actuellement vide. Pour rappel : * PC-1 : 00:50:79:66:68:00, 192.168.10.118 * PC-2 : 00:50:79:66:68:01, 192.168.10.120 * KALI : 00:0C:29:05:A1:31, 192.168.10.104 Depuis KALI : arpspoof -t 192.168.10.118 192.168.10.120 Traduction litt\u00e9rale : Aupr\u00e8s de PC-1 (192.168.10.118) fait moi passer pour PC-2 (192.168.10.120). Sur le poste le cache ARP est vide : PC-1> show arp Mais depuis le switch (SW-1), il est possible d'observer ces lignes de logs : Le switch a d\u00e9tecter que KALI envoie des r\u00e9ponses ARP falsifi\u00e9s car cette association (MAC <-> IP ) n'est pas pr\u00e9sente : * Dans le cache DHCP snooping, * Le port n'a pas \u00e9t\u00e9 d\u00e9finis en trust donc cette association n'est pas pris en compte par le switch,","title":"2.2 Tentative d'attaque :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#3-conclusion","text":"Pour conclure sur la s\u00e9curit\u00e9 des protocoles : * Attaque DHCP Starvation -> Port Security, * Attaque DHCP Spoofing -> DHCP Snooping, * Attaque ARP Spoofing -> DAI avec DHCP Snooping,","title":"3 Conclusion :"}]}