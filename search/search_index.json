{"config":{"lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Welcome to GJ enterprise documentation website !","title":"Welcome to GJ enterprise documentation website !"},{"location":"#welcome-to-gj-enterprise-documentation-website","text":"","title":"Welcome to GJ enterprise documentation website !"},{"location":"ajouter_documentations/","text":"Ajout_documentations.md Sommaire Ecrire la documentation Pousser sur Github D\u00e9ployer la documentation Requirements Cl\u00e9 publique sur votre compte github (\u00e9viter d'entrer le password \u00e0 chaque commit) Python 3 pip3 sudo apt-get install python3 pip3 Package mkdocs pip install mkdocs Ecrire la documentation Il faut \u00e9crire la documentation sur la branche master , dans le dossier docs . Pousser sur Github Une fois la documentation \u00e9crite, il faut la pousser sur Github, branche master . git pull git add XXXX.md git commit -m \"ajout doc\" git push Attention il existe 2 branches : master et gh-deploy . Cette deuxi\u00e8me est utilis\u00e9 par Github pages comme source pour le site web. Ne rien pousser sur cette branche => travail perdu au prochain deploiement ! D\u00e9ployer la documentation sur le site. Sur la m\u00eame branche master , executer la commande : mkdocs gh-deploy Fini.","title":"Ajout_documentations.md"},{"location":"ajouter_documentations/#ajout_documentationsmd","text":"","title":"Ajout_documentations.md"},{"location":"ajouter_documentations/#sommaire","text":"Ecrire la documentation Pousser sur Github D\u00e9ployer la documentation","title":"Sommaire"},{"location":"ajouter_documentations/#requirements","text":"Cl\u00e9 publique sur votre compte github (\u00e9viter d'entrer le password \u00e0 chaque commit) Python 3 pip3 sudo apt-get install python3 pip3 Package mkdocs pip install mkdocs","title":"Requirements"},{"location":"ajouter_documentations/#ecrire-la-documentation","text":"Il faut \u00e9crire la documentation sur la branche master , dans le dossier docs .","title":"Ecrire la documentation"},{"location":"ajouter_documentations/#pousser-sur-github","text":"Une fois la documentation \u00e9crite, il faut la pousser sur Github, branche master . git pull git add XXXX.md git commit -m \"ajout doc\" git push Attention il existe 2 branches : master et gh-deploy . Cette deuxi\u00e8me est utilis\u00e9 par Github pages comme source pour le site web. Ne rien pousser sur cette branche => travail perdu au prochain deploiement !","title":"Pousser sur Github"},{"location":"ajouter_documentations/#deployer-la-documentation-sur-le-site","text":"Sur la m\u00eame branche master , executer la commande : mkdocs gh-deploy Fini.","title":"D\u00e9ployer la documentation sur le site."},{"location":"CentOs/Installer_apache_httpd/","text":"Installation d'un serveur Aapche HTTPD Installation Mettre \u00e0 jour les paquets sudo yum update Installer la paquet httpd sudo yum install httpd Lancer Apache sudo systemctl start httpd Lancer apache au d\u00e9marrage sudo systemctl enable httpd Checker le status sudo systemctl status httpd Ajouter les r\u00e8gles dans la parfeu Par defaut CentOS empeche le traffic entrant vers 80 et 443 sudo firewall-cmd \u2013\u2013permanent \u2013\u2013add-port=80/tcp sudo firewall-cmd \u2013\u2013permanent \u2013\u2013add-port=443/tcp Recharger le par feu pour appliquer les changements sudo firewall-cmd \u2013\u2013reload Done ! Configuration Les fichiers de configuration sont situ\u00e9 : /etc/httpd Le fichier de config principal est situ\u00e9 : /etc/httpd/conf/httpd.conf Les autres fichiers de configurations doivent : se termin\u00e9s par .conf s'inclure dans le fichier de conf principal se situer : /etc/httpd/conf.d/ Il est possible d'ajouter des fonctionnalit\u00e9s \u00e0 apache via des modules : Chemin : /etc/httpd/conf.modules.d/ Logs chemin : /var/log/httpd/ Commandes administration Stopper le service apache sudo systemctl stop httpd D\u00e9marrer le service apache sudo systemctl start httpd Red\u00e9marrer le service apache sudo systemctl restart httpd Lancer apache au d\u00e9marrage sudo systemctl enable httpd Retirer apache au d\u00e9marrage sudo systemctl disable httpd","title":"Installation d'un serveur Aapche HTTPD"},{"location":"CentOs/Installer_apache_httpd/#installation-dun-serveur-aapche-httpd","text":"","title":"Installation d'un serveur Aapche HTTPD"},{"location":"CentOs/Installer_apache_httpd/#installation","text":"Mettre \u00e0 jour les paquets sudo yum update Installer la paquet httpd sudo yum install httpd Lancer Apache sudo systemctl start httpd Lancer apache au d\u00e9marrage sudo systemctl enable httpd Checker le status sudo systemctl status httpd Ajouter les r\u00e8gles dans la parfeu Par defaut CentOS empeche le traffic entrant vers 80 et 443 sudo firewall-cmd \u2013\u2013permanent \u2013\u2013add-port=80/tcp sudo firewall-cmd \u2013\u2013permanent \u2013\u2013add-port=443/tcp Recharger le par feu pour appliquer les changements sudo firewall-cmd \u2013\u2013reload Done !","title":"Installation"},{"location":"CentOs/Installer_apache_httpd/#configuration","text":"Les fichiers de configuration sont situ\u00e9 : /etc/httpd Le fichier de config principal est situ\u00e9 : /etc/httpd/conf/httpd.conf Les autres fichiers de configurations doivent : se termin\u00e9s par .conf s'inclure dans le fichier de conf principal se situer : /etc/httpd/conf.d/ Il est possible d'ajouter des fonctionnalit\u00e9s \u00e0 apache via des modules : Chemin : /etc/httpd/conf.modules.d/ Logs chemin : /var/log/httpd/","title":"Configuration"},{"location":"CentOs/Installer_apache_httpd/#commandes-administration","text":"Stopper le service apache sudo systemctl stop httpd D\u00e9marrer le service apache sudo systemctl start httpd Red\u00e9marrer le service apache sudo systemctl restart httpd Lancer apache au d\u00e9marrage sudo systemctl enable httpd Retirer apache au d\u00e9marrage sudo systemctl disable httpd","title":"Commandes administration"},{"location":"CentOs/apache_TLS_SSL/","text":"Apache / TLS / SSL SSL Secure Socket Layer est un protocol utilis\u00e9 pour s\u00e9curis\u00e9 les traffics sur internet. Utilise une pair de cl\u00e9 priv\u00e9e/publique. Derni\u00e8re version SSLV3 Ce protocol est d\u00e9pr\u00e9ci\u00e9, il ne doit plus \u00eatre utilis\u00e9 ! SSL a \u00e9t\u00e9 remplac\u00e9 par TLS TLS Transport Layer Security Derni\u00e8re version stable : 1.2 La version 1.3 arrive Pour quelle utilit\u00e9 ? SSL et TLS Ont pour but de s\u00e9curis\u00e9 le traffic internet. Toutes les donn\u00e9es qui transient lors d'une requ\u00eate web basique passent en clair par tous les interm\u00e9diaires entre le client et le serveur (les switchs, routeurs, etc). Il faut donc chiffrer ces donn\u00e9es => SSL / TLS TLS requirements Chiffrer les donn\u00e9es \u00e9chang\u00e9es Authentifier au moins un interlocuteur (client/serveur) => assurer l'int\u00e9grit\u00e9 des donn\u00e9es => Eviter les MITMs Eviter les MITM PKI Public Key Infrastructure : L'utilisation de cl\u00e9 publiques, certificats pour authentifier les intelrocuteurs. TLS Toujours utilis\u00e9 la derni\u00e8re version du protocol TLS, une ancienne version expose les donn\u00e9es \u00e0 des failles de s\u00e9curit\u00e9. Apache HTTPD serveur Nous allons voir les fondamentaux pour s\u00e9curis\u00e9 un serveur web Apache.","title":"Apache / TLS / SSL"},{"location":"CentOs/apache_TLS_SSL/#apache-tls-ssl","text":"","title":"Apache / TLS / SSL"},{"location":"CentOs/apache_TLS_SSL/#ssl","text":"Secure Socket Layer est un protocol utilis\u00e9 pour s\u00e9curis\u00e9 les traffics sur internet. Utilise une pair de cl\u00e9 priv\u00e9e/publique. Derni\u00e8re version SSLV3 Ce protocol est d\u00e9pr\u00e9ci\u00e9, il ne doit plus \u00eatre utilis\u00e9 !","title":"SSL"},{"location":"CentOs/apache_TLS_SSL/#ssl-a-ete-remplace-par-tls","text":"","title":"SSL a \u00e9t\u00e9 remplac\u00e9 par TLS"},{"location":"CentOs/apache_TLS_SSL/#tls","text":"Transport Layer Security Derni\u00e8re version stable : 1.2 La version 1.3 arrive","title":"TLS"},{"location":"CentOs/apache_TLS_SSL/#pour-quelle-utilite","text":"SSL et TLS Ont pour but de s\u00e9curis\u00e9 le traffic internet. Toutes les donn\u00e9es qui transient lors d'une requ\u00eate web basique passent en clair par tous les interm\u00e9diaires entre le client et le serveur (les switchs, routeurs, etc). Il faut donc chiffrer ces donn\u00e9es => SSL / TLS","title":"Pour quelle utilit\u00e9 ?"},{"location":"CentOs/apache_TLS_SSL/#tls-requirements","text":"Chiffrer les donn\u00e9es \u00e9chang\u00e9es Authentifier au moins un interlocuteur (client/serveur) => assurer l'int\u00e9grit\u00e9 des donn\u00e9es => Eviter les MITMs","title":"TLS requirements"},{"location":"CentOs/apache_TLS_SSL/#eviter-les-mitm","text":"","title":"Eviter les MITM"},{"location":"CentOs/apache_TLS_SSL/#pki","text":"Public Key Infrastructure : L'utilisation de cl\u00e9 publiques, certificats pour authentifier les intelrocuteurs.","title":"PKI"},{"location":"CentOs/apache_TLS_SSL/#tls_1","text":"Toujours utilis\u00e9 la derni\u00e8re version du protocol TLS, une ancienne version expose les donn\u00e9es \u00e0 des failles de s\u00e9curit\u00e9.","title":"TLS"},{"location":"CentOs/apache_TLS_SSL/#apache-httpd-serveur","text":"Nous allons voir les fondamentaux pour s\u00e9curis\u00e9 un serveur web Apache.","title":"Apache HTTPD serveur"},{"location":"CentOs/creation_compte_utilisateurs/","text":"Cr\u00e9ation de compte utilisateur","title":"Cr\u00e9ation de compte utilisateur"},{"location":"CentOs/creation_compte_utilisateurs/#creation-de-compte-utilisateur","text":"","title":"Cr\u00e9ation de compte utilisateur"},{"location":"CentOs/regle_parfeu/","text":"Mise en place de r\u00e8gles firewall source : https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-firewalld-on-centos-7 firewall-cmd Concept Le processus wirewalld g\u00e8re des groupes de r\u00e8gles appel\u00e9s zones . Une zone et un ensemble de r\u00e8gle qui d\u00e9fini les actions \u00e0 r\u00e9aliser sur le traffic r\u00e9seau. Le tout en se basant sur un syst\u00e8me de niveau de confiance . Les zones pr\u00e9d\u00e9finies drop : The lowest level of trust. All incoming connections are dropped without reply and only outgoing connections are possible. block : Similar to the above, but instead of simply dropping connections, incoming requests are rejected with an icmp-host-prohibited or icmp6-adm-prohibited message. public : Represents public, untrusted networks. You don\u2019t trust other computers but may allow selected incoming connections on a case-by-case basis. external : External networks in the event that you are using the firewall as your gateway. It is configured for NAT masquerading so that your internal network remains private but reachable. internal : The other side of the external zone, used for the internal portion of a gateway. The computers are fairly trustworthy and some additional services are available. dmz : Used for computers located in a DMZ (isolated computers that will not have access to the rest of your network). Only certain incoming connections are allowed. work : Used for work machines. Trust most of the computers in the network. A few more services might be allowed. home: A home environment. It generally implies that you trust most of the other computers and that a few more services will be accepted. trusted : Trust all of the machines in the network. The most open of the available options and should be used sparingly. Rules Les r\u00e8gles peuvent \u00eatre permanantes ou imm\u00e9diates, les r\u00e8gles imm\u00e9diates sont supprim\u00e9s \u00e0 chaque reboot. Installation firewalld vient par d\u00e9faut dans la pluspart des distributions linux, dont CentOs. Sinon il faut l'installer comme suit : sudo yum install firewalld sudo systemctl enable firewalld sudo reboot Voir le status de firewalld sudo firewall-cmd --state usage Zone par defaut sudo firewall-cmd --get-default-zone Zone active et sur quelles interfaces sudo firewall-cmd --get-active-zones On peut voir qu'une seul interface est g\u00e9rer par le parfeu, configur\u00e9 en zone public Voir toutes les r\u00e8gles sur la zone active sudo firewall-cmd --list-all Notes : Les port 80 et 443 proviennent d'une autre configuration. Voir toutes les zones disponibles firewall-cmd --get-zones Voir toutes les r\u00e8gles de toutes les zones : sudo firewall-cmd --list-all-zones Configurer une interface avec une zone De base, toutes les interfaces sont configurer sur la zone par defaut Affecter une interface \u00e0 une zone sudo firewall-cmd --zone=home --change-interface=eth0 Changer la zone par defaut Toutes les interfaces qui sont configur\u00e9s sur la zone par d\u00e9faut seront chang\u00e9es. sudo firewall-cmd --set-default-zone=home Manager les services Afficher tous les services sudo firewall-cmd --get-services Le dossier /usr/lib/firewalld/services/ contient les fichiers xml de chaque service, donnant plus d'informations. Ajouter un service \u00e0 une zone sudo firewall-cmd --zone=public --add-service=http Arguments optionnels : --zone : si non pr\u00e9cis\u00e9 => zone par defaut --permanent : si non pr\u00e9cis\u00e9 => regle temporaire Voir les services li\u00e9s \u00e0 une zone : sudo firewall-cmd --zone=public --list-services Cr\u00e9er un service Avec le temps et le nombre de r\u00e8gles, il peut-\u00eatre difficile de se rappeller pourquoi cette r\u00e8gle ? pourquoi ce port ? etc dans la configuration des zones. Il est possible de cr\u00e9er dun service, de lui attribuer un nom, une description et des ports ouverts. Il ne restera plus qu'\u00e0 ajouter, ou non, le service \u00e0 une zone. Copier/coller un service d\u00e9j\u00e0 existant dans /usr/lib/firewalld/services/ et renomer le comme d\u00e9sir\u00e9. sudo cp /usr/lib/firewalld/services/bitcoin.xml /usr/lib/firewalld/services/plex.xml Modifier le fichier de configuration Recharger firewalld sudo firewall-cmd --reload zones Cr\u00e9er une zone Il peut-\u00eatre utile de cr\u00e9er ses propres zones quand celle de base ne nous conviennent pas, cr\u00e9\u00e9es en nous une pour un serveur web. sudo firewall-cmd --permanent --new-zone=publicweb Il faut recharger firewalld pour prendre en compte la nouvelle zone sudo firewall-cmd --reload Ajoutons-y quelques r\u00e8gles, sans oublier de recharger par la suite. sudo firewall-cmd --zone=publicweb --add-service=ssh sudo firewall-cmd --zone=publicweb --add-service=http sudo firewall-cmd --zone=publicweb --add-service=https sudo firewall-cmd --zone=publicweb --list-all Affectons notre nouvelle zone \u00e0 une interface sudo firewall-cmd --zone=publicweb --change-interface=ens33 Ports Ouvir un port pour une zone sudo firewall-cmd --zone=public --add-port=80/tcp sudo firewall-cmd --zone=public --add-port=4990-4999/udp Liste des ports ouvert sur une zone sudo firewall-cmd --zone=public --permanent --list-ports iptables Depuis CentOS 7, iptables est d\u00e9pr\u00e9ci\u00e9, il est conseill\u00e9 d'utiliser firewalld . source : https://linoxide.com/firewall/setup-iptable-rules-centos/ Liste des r\u00e8gles sudo iptables -L Exemples Affiche le status d'IP table iptables -L -n -v Block NULL paquets iptables -A INPUT -p tcp --tcp-flags ALL NONE -j DROP Block SYN flood attaque iptables -A INPUT -p tcp ! --syn -m state --state NEW -j DROP Block Recon paquet iptables -A INPUT -p tcp --tcp-flags ALL ALL -j DROP Autorise addresse de loopback iptables -A INPUT -i lo -j ACCEPT Autorise le traffic web iptables -A INPUT -p tcp -m tcp --dport 80 -j ACCEPT iptables -A INPUT -p tcp -m tcp --dport 443 -j ACCEPT Autorise les le traffic smtp iptables -A INPUT -p tcp -m tcp --dport 25 -j ACCEPT iptables -A INPUT -p tcp -m tcp --dport 465 -j ACCEPT Autorise SSH Globalit\u00e9 iptables -A INPUT -p tcp -m tcp --dport 22 -j ACCEPT Autorise SSH depuis une source iptables -A INPUT -p tcp -s YOUR_IP_ADDRESS -m tcp --dport 22 -j ACCEPT Autorise une connection sortante \u00e9tablie \u00e0 recevoir une r\u00e9ponse iptables -I INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT Bannir une adresse IP iptables -A INPUT -s IP_ADDRESS -j DROP Bannir un port d'une certaine adresse iptables -A INPUT -p tcp -s IP_ADDRESS --dport PORT -j DROP Autoriser l'acc\u00e8s \u00e0 un port pour une certaine adresse IP iptables -A INPUT -p tcp -s IP_ADDRESS --dport PORT -j ACCEPT Open DNS iptables -A INPUT -m state --state NEW -p tcp --dport 53 -j ACCEPT Autoriser l'acc\u00e8s MYSQL port iptables -A INPUT -p tcp --dport 3306 -j ACCEPT Autorise l'acc\u00e8s sur une palge de port iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 7000:7100 -j ACCEPT Sauvegarder les r\u00e8gles et recharger iptable service iptables save service iptables restart","title":"Mise en place de r\u00e8gles firewall"},{"location":"CentOs/regle_parfeu/#mise-en-place-de-regles-firewall","text":"","title":"Mise en place de r\u00e8gles firewall"},{"location":"CentOs/regle_parfeu/#source-httpswwwdigitaloceancomcommunitytutorialshow-to-set-up-a-firewall-using-firewalld-on-centos-7","text":"","title":"source : https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-firewalld-on-centos-7"},{"location":"CentOs/regle_parfeu/#firewall-cmd","text":"","title":"firewall-cmd"},{"location":"CentOs/regle_parfeu/#concept","text":"Le processus wirewalld g\u00e8re des groupes de r\u00e8gles appel\u00e9s zones . Une zone et un ensemble de r\u00e8gle qui d\u00e9fini les actions \u00e0 r\u00e9aliser sur le traffic r\u00e9seau. Le tout en se basant sur un syst\u00e8me de niveau de confiance .","title":"Concept"},{"location":"CentOs/regle_parfeu/#les-zones-predefinies","text":"drop : The lowest level of trust. All incoming connections are dropped without reply and only outgoing connections are possible. block : Similar to the above, but instead of simply dropping connections, incoming requests are rejected with an icmp-host-prohibited or icmp6-adm-prohibited message. public : Represents public, untrusted networks. You don\u2019t trust other computers but may allow selected incoming connections on a case-by-case basis. external : External networks in the event that you are using the firewall as your gateway. It is configured for NAT masquerading so that your internal network remains private but reachable. internal : The other side of the external zone, used for the internal portion of a gateway. The computers are fairly trustworthy and some additional services are available. dmz : Used for computers located in a DMZ (isolated computers that will not have access to the rest of your network). Only certain incoming connections are allowed. work : Used for work machines. Trust most of the computers in the network. A few more services might be allowed. home: A home environment. It generally implies that you trust most of the other computers and that a few more services will be accepted. trusted : Trust all of the machines in the network. The most open of the available options and should be used sparingly.","title":"Les zones pr\u00e9d\u00e9finies"},{"location":"CentOs/regle_parfeu/#rules","text":"Les r\u00e8gles peuvent \u00eatre permanantes ou imm\u00e9diates, les r\u00e8gles imm\u00e9diates sont supprim\u00e9s \u00e0 chaque reboot.","title":"Rules"},{"location":"CentOs/regle_parfeu/#installation","text":"firewalld vient par d\u00e9faut dans la pluspart des distributions linux, dont CentOs. Sinon il faut l'installer comme suit : sudo yum install firewalld sudo systemctl enable firewalld sudo reboot Voir le status de firewalld sudo firewall-cmd --state","title":"Installation"},{"location":"CentOs/regle_parfeu/#usage","text":"Zone par defaut sudo firewall-cmd --get-default-zone Zone active et sur quelles interfaces sudo firewall-cmd --get-active-zones On peut voir qu'une seul interface est g\u00e9rer par le parfeu, configur\u00e9 en zone public Voir toutes les r\u00e8gles sur la zone active sudo firewall-cmd --list-all Notes : Les port 80 et 443 proviennent d'une autre configuration. Voir toutes les zones disponibles firewall-cmd --get-zones Voir toutes les r\u00e8gles de toutes les zones : sudo firewall-cmd --list-all-zones","title":"usage"},{"location":"CentOs/regle_parfeu/#configurer-une-interface-avec-une-zone","text":"De base, toutes les interfaces sont configurer sur la zone par defaut","title":"Configurer une interface avec une zone"},{"location":"CentOs/regle_parfeu/#affecter-une-interface-a-une-zone","text":"sudo firewall-cmd --zone=home --change-interface=eth0","title":"Affecter une interface \u00e0 une zone"},{"location":"CentOs/regle_parfeu/#changer-la-zone-par-defaut","text":"Toutes les interfaces qui sont configur\u00e9s sur la zone par d\u00e9faut seront chang\u00e9es. sudo firewall-cmd --set-default-zone=home","title":"Changer la zone par defaut"},{"location":"CentOs/regle_parfeu/#manager-les-services","text":"","title":"Manager les services"},{"location":"CentOs/regle_parfeu/#afficher-tous-les-services","text":"sudo firewall-cmd --get-services Le dossier /usr/lib/firewalld/services/ contient les fichiers xml de chaque service, donnant plus d'informations.","title":"Afficher tous les services"},{"location":"CentOs/regle_parfeu/#ajouter-un-service-a-une-zone","text":"sudo firewall-cmd --zone=public --add-service=http Arguments optionnels : --zone : si non pr\u00e9cis\u00e9 => zone par defaut --permanent : si non pr\u00e9cis\u00e9 => regle temporaire","title":"Ajouter un service \u00e0 une zone"},{"location":"CentOs/regle_parfeu/#voir-les-services-lies-a-une-zone","text":"sudo firewall-cmd --zone=public --list-services","title":"Voir les services li\u00e9s \u00e0 une zone :"},{"location":"CentOs/regle_parfeu/#creer-un-service","text":"Avec le temps et le nombre de r\u00e8gles, il peut-\u00eatre difficile de se rappeller pourquoi cette r\u00e8gle ? pourquoi ce port ? etc dans la configuration des zones. Il est possible de cr\u00e9er dun service, de lui attribuer un nom, une description et des ports ouverts. Il ne restera plus qu'\u00e0 ajouter, ou non, le service \u00e0 une zone. Copier/coller un service d\u00e9j\u00e0 existant dans /usr/lib/firewalld/services/ et renomer le comme d\u00e9sir\u00e9. sudo cp /usr/lib/firewalld/services/bitcoin.xml /usr/lib/firewalld/services/plex.xml Modifier le fichier de configuration Recharger firewalld sudo firewall-cmd --reload","title":"Cr\u00e9er un service"},{"location":"CentOs/regle_parfeu/#zones","text":"","title":"zones"},{"location":"CentOs/regle_parfeu/#creer-une-zone","text":"Il peut-\u00eatre utile de cr\u00e9er ses propres zones quand celle de base ne nous conviennent pas, cr\u00e9\u00e9es en nous une pour un serveur web. sudo firewall-cmd --permanent --new-zone=publicweb Il faut recharger firewalld pour prendre en compte la nouvelle zone sudo firewall-cmd --reload Ajoutons-y quelques r\u00e8gles, sans oublier de recharger par la suite. sudo firewall-cmd --zone=publicweb --add-service=ssh sudo firewall-cmd --zone=publicweb --add-service=http sudo firewall-cmd --zone=publicweb --add-service=https sudo firewall-cmd --zone=publicweb --list-all Affectons notre nouvelle zone \u00e0 une interface sudo firewall-cmd --zone=publicweb --change-interface=ens33","title":"Cr\u00e9er une zone"},{"location":"CentOs/regle_parfeu/#ports","text":"","title":"Ports"},{"location":"CentOs/regle_parfeu/#ouvir-un-port-pour-une-zone","text":"sudo firewall-cmd --zone=public --add-port=80/tcp sudo firewall-cmd --zone=public --add-port=4990-4999/udp","title":"Ouvir un port pour une zone"},{"location":"CentOs/regle_parfeu/#liste-des-ports-ouvert-sur-une-zone","text":"sudo firewall-cmd --zone=public --permanent --list-ports","title":"Liste des ports ouvert sur une zone"},{"location":"CentOs/regle_parfeu/#iptables","text":"Depuis CentOS 7, iptables est d\u00e9pr\u00e9ci\u00e9, il est conseill\u00e9 d'utiliser firewalld .","title":"iptables"},{"location":"CentOs/regle_parfeu/#source-httpslinoxidecomfirewallsetup-iptable-rules-centos","text":"Liste des r\u00e8gles sudo iptables -L","title":"source : https://linoxide.com/firewall/setup-iptable-rules-centos/"},{"location":"CentOs/regle_parfeu/#exemples","text":"Affiche le status d'IP table iptables -L -n -v Block NULL paquets iptables -A INPUT -p tcp --tcp-flags ALL NONE -j DROP Block SYN flood attaque iptables -A INPUT -p tcp ! --syn -m state --state NEW -j DROP Block Recon paquet iptables -A INPUT -p tcp --tcp-flags ALL ALL -j DROP Autorise addresse de loopback iptables -A INPUT -i lo -j ACCEPT Autorise le traffic web iptables -A INPUT -p tcp -m tcp --dport 80 -j ACCEPT iptables -A INPUT -p tcp -m tcp --dport 443 -j ACCEPT Autorise les le traffic smtp iptables -A INPUT -p tcp -m tcp --dport 25 -j ACCEPT iptables -A INPUT -p tcp -m tcp --dport 465 -j ACCEPT Autorise SSH Globalit\u00e9 iptables -A INPUT -p tcp -m tcp --dport 22 -j ACCEPT Autorise SSH depuis une source iptables -A INPUT -p tcp -s YOUR_IP_ADDRESS -m tcp --dport 22 -j ACCEPT Autorise une connection sortante \u00e9tablie \u00e0 recevoir une r\u00e9ponse iptables -I INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT Bannir une adresse IP iptables -A INPUT -s IP_ADDRESS -j DROP Bannir un port d'une certaine adresse iptables -A INPUT -p tcp -s IP_ADDRESS --dport PORT -j DROP Autoriser l'acc\u00e8s \u00e0 un port pour une certaine adresse IP iptables -A INPUT -p tcp -s IP_ADDRESS --dport PORT -j ACCEPT Open DNS iptables -A INPUT -m state --state NEW -p tcp --dport 53 -j ACCEPT Autoriser l'acc\u00e8s MYSQL port iptables -A INPUT -p tcp --dport 3306 -j ACCEPT Autorise l'acc\u00e8s sur une palge de port iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 7000:7100 -j ACCEPT","title":"Exemples"},{"location":"CentOs/regle_parfeu/#sauvegarder-les-regles-et-recharger-iptable","text":"service iptables save service iptables restart","title":"Sauvegarder les r\u00e8gles et recharger iptable"},{"location":"Cisco/Segmenter%20les%20communications%20et%20les%20filtrer/","text":"Segmenter les communications et les filtrer Ressources : * * * 1 Les VLAN et ACL : 1.1 Le laboratoire : Illustration 1 : Plan r\u00e9seau du laboratoire. 1.2 Mise en pratique : 1.3 S\u00e9curisation de l'infrastructure : 1.4 Test : 2 Les PVLAN : 2.1 Le laboratoire : 2.2 Mise en pratique : 2.3 S\u00e9curisation de l'infrastructure : 2.4 Test :","title":"Segmenter les communications et les filtrer"},{"location":"Cisco/Segmenter%20les%20communications%20et%20les%20filtrer/#segmenter-les-communications-et-les-filtrer","text":"Ressources : * * *","title":"Segmenter les communications et les filtrer"},{"location":"Cisco/Segmenter%20les%20communications%20et%20les%20filtrer/#1-les-vlan-et-acl","text":"","title":"1 Les VLAN et ACL :"},{"location":"Cisco/Segmenter%20les%20communications%20et%20les%20filtrer/#11-le-laboratoire","text":"Illustration 1 : Plan r\u00e9seau du laboratoire.","title":"1.1 Le laboratoire :"},{"location":"Cisco/Segmenter%20les%20communications%20et%20les%20filtrer/#12-mise-en-pratique","text":"","title":"1.2 Mise en pratique :"},{"location":"Cisco/Segmenter%20les%20communications%20et%20les%20filtrer/#13-securisation-de-linfrastructure","text":"","title":"1.3 S\u00e9curisation de l'infrastructure :"},{"location":"Cisco/Segmenter%20les%20communications%20et%20les%20filtrer/#14-test","text":"","title":"1.4 Test :"},{"location":"Cisco/Segmenter%20les%20communications%20et%20les%20filtrer/#2-les-pvlan","text":"","title":"2 Les PVLAN :"},{"location":"Cisco/Segmenter%20les%20communications%20et%20les%20filtrer/#21-le-laboratoire","text":"","title":"2.1 Le laboratoire :"},{"location":"Cisco/Segmenter%20les%20communications%20et%20les%20filtrer/#22-mise-en-pratique","text":"","title":"2.2 Mise en pratique :"},{"location":"Cisco/Segmenter%20les%20communications%20et%20les%20filtrer/#23-securisation-de-linfrastructure","text":"","title":"2.3 S\u00e9curisation de l'infrastructure :"},{"location":"Cisco/Segmenter%20les%20communications%20et%20les%20filtrer/#24-test","text":"","title":"2.4 Test :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/","text":"S\u00e9curiser - CDP et LLDP : Ressource : https://cisco.goffinet.org/ccna/gestion-infrastructure/cdp-et-lldp/ Dans ce billet j'utilise uniquement un switch mais la configuration est identique sur un routeur. 0 Le laboratoire : Voici le laboratoire que j'utilise pour tester la s\u00e9curit\u00e9 des protocoles CDP et LLDP : Illustration 1 : Plan r\u00e9seau du laboratoire. Adressage MAC : KALI, 00:0C:29:05:A1:31 SW-1, 0C:44:BE:18:8F:00 1 Le protocole CDP : 1.1 Activer CDP : Par d\u00e9faut CDP est actif sur tous les ports d'un equipement Cisco, mais il est possible de l'activer (ou r\u00e9-activer) comme ceci : SW-1(config)# cdp run Ou uniquement de l'activer sur une interface : SW-1(config)# interface GigabitEthernet 0/0 SW-1(config)# cdp enable 1.2 D\u00e9sactiver CDP : Pour d\u00e9sactiver CDP globalement : SW-1(config)# no cdp run Ou le d\u00e9sactiver sur un ou des port(s) sp\u00e9cifique(s) : SW-1(config)# interface GigabitEthernet 0/0 SW-1(config)# no cdp enable 1.3 Voir les voisins CDP depuis Kali : Depuis la VM KALI, utilisation de Wireshark avec le filtre cdp : Illustration 2 : Trame CDP de SW-1. Sous Kali-Linux, il est aussi possible d'utiliser ces logiciels pour r\u00e9cup\u00e9rer les informations CDP : Cdpsnarf, Yersinia, 1.4 Voir les voisins CDP depuis Cisco : Sur un switch Cisco pour voir les voisins : SW-1# show cdp neighbors detail 2 Le protocole LLDP : 2.1 Activer LLDP : Le protocole LLDP n'est pas par d\u00e9faut actif sur les \u00e9quipements Cisco, mais il est possible de l'activer comme ceci : SW-1(config)# lldp run Ou uniquement de l'activer sur une interface : SW-1(config)# interface GigabitEthernet 0/0 SW-1(config)# lldp transmit 2.2 D\u00e9sactiver LLDP : Pour d\u00e9sactiver LLDP globalement : SW-1(config)# no lldp run Ou le d\u00e9sactiver sur un ou des port(s) sp\u00e9cifique(s) : SW-1(config)# interface GigabitEthernet 0/0 SW-1(config)# no lldp transmit 2.3 Voir les voisins LLDP depuis Kali : Depuis la VM KALI, utilisation de Wireshark avec le filtre lldp : Illustration 3 : Trame LLDP de SW-1. Sous Kali-Linux, il est aussi possible d'utiliser ces logiciels pour r\u00e9cup\u00e9rer les informations LLDP : Lldpd, Yersinia, 2.4 Voir les voisins LLDP depuis Cisco : Sur un switch Cisco pour voir les voisins : SW-1# show lldp neighbors detail 3 Conclusion : Par d\u00e9faut, sur les switchs et routeurs Cisco : CDP est activ\u00e9, LLDP est d\u00e9sactiv\u00e9 Il peut \u00eatre possible de d\u00e9sactiver ces deux protocoles : Sur l'\u00e9quipement en entier, Sur une interface sp\u00e9cifique,","title":"S\u00e9curiser - CDP et LLDP :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#securiser-cdp-et-lldp","text":"Ressource : https://cisco.goffinet.org/ccna/gestion-infrastructure/cdp-et-lldp/ Dans ce billet j'utilise uniquement un switch mais la configuration est identique sur un routeur.","title":"S\u00e9curiser - CDP et LLDP :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#0-le-laboratoire","text":"Voici le laboratoire que j'utilise pour tester la s\u00e9curit\u00e9 des protocoles CDP et LLDP : Illustration 1 : Plan r\u00e9seau du laboratoire. Adressage MAC : KALI, 00:0C:29:05:A1:31 SW-1, 0C:44:BE:18:8F:00","title":"0 Le laboratoire :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#1-le-protocole-cdp","text":"","title":"1 Le protocole CDP :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#11-activer-cdp","text":"Par d\u00e9faut CDP est actif sur tous les ports d'un equipement Cisco, mais il est possible de l'activer (ou r\u00e9-activer) comme ceci : SW-1(config)# cdp run Ou uniquement de l'activer sur une interface : SW-1(config)# interface GigabitEthernet 0/0 SW-1(config)# cdp enable","title":"1.1 Activer CDP :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#12-desactiver-cdp","text":"Pour d\u00e9sactiver CDP globalement : SW-1(config)# no cdp run Ou le d\u00e9sactiver sur un ou des port(s) sp\u00e9cifique(s) : SW-1(config)# interface GigabitEthernet 0/0 SW-1(config)# no cdp enable","title":"1.2 D\u00e9sactiver CDP :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#13-voir-les-voisins-cdp-depuis-kali","text":"Depuis la VM KALI, utilisation de Wireshark avec le filtre cdp : Illustration 2 : Trame CDP de SW-1. Sous Kali-Linux, il est aussi possible d'utiliser ces logiciels pour r\u00e9cup\u00e9rer les informations CDP : Cdpsnarf, Yersinia,","title":"1.3 Voir les voisins CDP depuis Kali :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#14-voir-les-voisins-cdp-depuis-cisco","text":"Sur un switch Cisco pour voir les voisins : SW-1# show cdp neighbors detail","title":"1.4 Voir les voisins CDP depuis Cisco :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#2-le-protocole-lldp","text":"","title":"2 Le protocole LLDP :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#21-activer-lldp","text":"Le protocole LLDP n'est pas par d\u00e9faut actif sur les \u00e9quipements Cisco, mais il est possible de l'activer comme ceci : SW-1(config)# lldp run Ou uniquement de l'activer sur une interface : SW-1(config)# interface GigabitEthernet 0/0 SW-1(config)# lldp transmit","title":"2.1 Activer LLDP :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#22-desactiver-lldp","text":"Pour d\u00e9sactiver LLDP globalement : SW-1(config)# no lldp run Ou le d\u00e9sactiver sur un ou des port(s) sp\u00e9cifique(s) : SW-1(config)# interface GigabitEthernet 0/0 SW-1(config)# no lldp transmit","title":"2.2 D\u00e9sactiver LLDP :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#23-voir-les-voisins-lldp-depuis-kali","text":"Depuis la VM KALI, utilisation de Wireshark avec le filtre lldp : Illustration 3 : Trame LLDP de SW-1. Sous Kali-Linux, il est aussi possible d'utiliser ces logiciels pour r\u00e9cup\u00e9rer les informations LLDP : Lldpd, Yersinia,","title":"2.3 Voir les voisins LLDP depuis Kali :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#24-voir-les-voisins-lldp-depuis-cisco","text":"Sur un switch Cisco pour voir les voisins : SW-1# show lldp neighbors detail","title":"2.4 Voir les voisins LLDP depuis Cisco :"},{"location":"Cisco/S%C3%A9curiser%20%20CDP%20et%20LLDP/#3-conclusion","text":"Par d\u00e9faut, sur les switchs et routeurs Cisco : CDP est activ\u00e9, LLDP est d\u00e9sactiv\u00e9 Il peut \u00eatre possible de d\u00e9sactiver ces deux protocoles : Sur l'\u00e9quipement en entier, Sur une interface sp\u00e9cifique,","title":"3 Conclusion :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/","text":"S\u00e9curiser - ARP et DHCP : Ressources : DHCP, https://formip.com/dhcp-snooping/ DHCP, https://medium.com/@ayushir/dhcp-snooping-attack-ca728e4dd84 ARP, https://formip.com/dai/ 0 Le laboratoire : Voici le laboratoire que j'utilise pour tester la s\u00e9curit\u00e9 des protocoles DHCP et ARP : Illustration 1 : Plan r\u00e9seau du laboratoire. Adressage IP et MAC : PC-1, DHCP, 00:50:79:66:68:00 PC-2, DHCP, 00:50:79:66:68:01 DHCP, 192.168.10.31/24, 00:0C:29:07:DB:B1 KALI, DHCP, 00:0C:29:05:A1:31 SW-1, 192.168.10.1/24 Tous les h\u00f4tes du laboratoire sont dans le VLAN 1. Configuration du serveur DHCP : option domain-name \"example.org\"; option domain-name-servers ns1.example.org, ns2.example.org; default-lease-time 600; max-lease-time 7200; subnet 192.168.10.0 netmask 255.255.255.0 { range 192.168.10.100 192.168.10.120; option subnet-mask 255.255.255.0; option broadcast-address 192.168.10.255; } 1 S\u00e9curiser le protocole DHCP : Les attaques sur le protocole DHCP : DHCP Starvation, reserver tous les baux du serveur DHCP. Ce qui \u00e0 pour cons\u00e9quence que les clients n'obtiennent plus de configuration IP. DHCP Spoofing, un attaquant distribue des configuration IP o\u00f9 il se d\u00e9finit en tant que passerelle. Ce qui permet de r\u00e9aliser un MITM, 1.1 Miitigation : 1.1.1 DHCP Snooping : Mise en place du DHCP snooping sur le VLAN 1 : SW-1(config)# ip dhcp snooping SW-1(config)# ip dhcp snooping vlan 1 SW-1(config)# no ip dhcp snooping information option D\u00e9tail des commandes : 1 Activation du DHCP Snooping globalement, 2 Activation du DHCP Snooping sur le VLAN 1, \u00e9tape n\u00e9cessaire sans celle-ci le DHCP snooping n'est pas fonctionnel, 3 L'activation globale du DHCP snooping active l'option DHCP 82, Option 82 d\u00e9finition : Cette option sp\u00e9cifie le r\u00e9seau source de la demande, dans une architecture r\u00e9seau ou le serveur DHCP se trouve dans un sous-r\u00e9seau diff\u00e9rent. La trame est relay\u00e9e par le routeur via l'agent relai. Dans ce contexte, un switch ou un routeur peut ajouter dans l'option 82 le r\u00e9seau source de la demande DHCP. Certains serveurs DHCP n'acceptent pas l'option 82, il peut \u00eatre n\u00e9cessaire de la d\u00e9sactiver. Trust du port GigabitEthernet 3/1 du switch SW-1 ou le serveur DHCP est connect\u00e9 : SW-1(config)# interface GigabitEthernet 3/1 SW-1(config-if)# ip dhcp snooping trust SW-1(config-if)# ip dhcp snooping limit rate 80 D\u00e9tail des commandes : * * 1 S\u00e9lection de l'interface, * 2 Trust de l'interface * 3 Mise en place d'un quota, dans l'exemple ce port est limit\u00e9 \u00e0 80 requ\u00eates DHCP/secondes. 1.1.2 Port Security : Le port-security limite le nombre d'adresses MAC r\u00e9f\u00e9renc\u00e9 sur un port. Ce qui \u00e0 pour cons\u00e9quence direct de mitiguer l'attaque DHCP Starvation Sur le switch SW-1 sur le port de PC-1 : SW-1(config)# interface GigabitEthernet 1/1 SW-1(config-if)# switchport mode access SW-1(config-if)# switchport port-security SW-1(config-if)# switchport port-security max 3 SW-1(config-if)# switchport port-security violation shutdown SW-1(config-if)# exit Sur le switch SW-1 sur le port de PC-2 : SW-1(config)# interface GigabitEthernet 1/2 SW-1(config-if)# switchport mode access SW-1(config-if)# switchport port-security max 3 SW-1(config-if)# switchport port-security violation shutdown SW-1(config-if)# exit Sur le switch SW-1 sur le port de KALI : SW-1(config)# interface GigabitEthernet 2/1 SW-1(config-if)# switchport mode access SW-1(config-if)# switchport port-security max 3 SW-1(config-if)# switchport port-security violation shutdown SW-1(config-if)# exit S'il y a plus de trois adresse MAC associ\u00e9 \u00e0 un port dans la table CAM du switch SW-1 , le port en question est \u00e9teint (shutdown). Cette limitation permet de \"voler\" au maximum trois baux par le pirate. 1.2 V\u00e9rification : 1.2.1 V\u00e9rification DHCP Snooping : Commandes pour v\u00e9rifier le DHCP Snooping : SW-1# show ip dhcp snooping Illustration 2 : V\u00e9rification des ports trusts. Il est possible de noter : L'option 82 est d\u00e9sactiv\u00e9, L'interface GigabitEthernet 3/1 est une interface trust par le switch SW-1 pour les trames DHCP, Commandes pour voir les baux DHCP distribu\u00e9s (table DHCP Snooping) : SW-1# show ip dhcp snooping binding Illustration 3 : V\u00e9rification des baux DHCP. Dans cette capture, il est possible de voir que le DHCP \u00e0 distribu\u00e9 trois baux DHCP, on y retrouve : L'adresse MAC du client, L'adresse IP distribu\u00e9e par le DHCP, Lease time du bail DHCP, L'interface du client, Il est possible de clear la table DHCP Snooping : SW-1# clear ip dhcp snooping binding * 1.2.1 V\u00e9rification Port Security : Voir les ports d\u00e9finis en tant que port security : SW-1# show port-security Illustration 4 : Port security configuration initiale. Nous pouvons remarquer que le port security permet \u00e0 chaque port, trois adresses MAC diff\u00e9rentes au maximum. Une adresse MAC est d\u00e9ja utilis\u00e9 sur chaque port il en reste donc deux de disponible. 1.3 Tentative d'attaque : 1.3.1 DHCP Starvation : Pour rappel le port security est actif est configurer pour autoriser trois adresses MAC diff\u00e9rentes sur chaque port du switch SW-1. Utilisation de yersinia , depuis la VM KALI : yersinia -G Se rendre dans : onglet DHCP -> DHCP Starvation -> OK Apr\u00e8s un cours instant, la VM KALI r\u00e9alise un nombre infini de requ\u00eate DHCP Discover dans l'objectif d'utiliser tous les baux DHCP du serveur DHCP. Mais le port security limite \u00e0 un maximum de trois adresses MAC sur le port ou est connect\u00e9 KALI (donc trois demandes DHCP Discover). Ce qui \u00e0 pour cons\u00e9quence de placer le port en mode err-disabled et de le rendre inutilisable. Aper\u00e7u : SW-1# show port-security SW-1# show interface status Illustration 5 : Status du port security apr\u00e8s l'attaque. Illustration 6 : Port d\u00e9sactiv\u00e9 zpar le DHCP snooping. Pour rendre ce port \u00e0 nouveau fonctionnel : SW-1(config)# interface GigabitEthernet 2/1 SW-1(config-if)# shutdown SW-1(config-if)# no shutdown 1.3.2 DHCP Spoofing : Pour rappel seul le port vers le serveur DHCP GigabitEthernet 3/1 est trust pour les trames DHCP Offer. Utilisation de ethercap, depuis la VM KALI : ettercap -G Afin d'obtenir de meilleurs r\u00e9sultats, j'arr\u00eate le service DHCP du serveur DHCP : /etc/init.d/isc-dhcp-server stop Malgr\u00e9 que la VM KALI distribue des baux DHCP, aucun poste obtient une configuration IP. Mais si je place l'interface de la VM KALI en mode DHCP Snooping trust : SW-1(config)# interface GigabitEthernet 2/1 SW-1(config-if)# ip dhcp snooping trust Et que je renouvelle les demande DHCP de PC-1 et PC-2 : PC-1> ip dhcp PC-2> ip dhcp Les postes obtiennent une configuration IP. Depuis Ethercap : Illustration 7 : Log d'ethercap. Configuration IP des postes : PC-1> show ip Illustration 8 : Bail DHCP des postes. Nous pouvons remarquer que la valeur de la passerelle des configurations IP des postes correspond \u00e0 l'adresse IP de la VM KALI . Cette action a uniquement \u00e9t\u00e9 possible car j'ai plac\u00e9 le port de la VM KALI en mode DHCP Snooping trust . Sans cette modifications, les postes n'auraient jamais pu obtenir un bail DHCP. 2 S\u00e9curiser le protocole ARP : Pour s\u00e9curiser le protocole ARP, il est possible de s'appuyer sur la fonctionnalit\u00e9 DHCP snooping . En effet, le DHCP Snooping construit une table de correspondance qui r\u00e9f\u00e9rence l'adresse MAC et l'adresse IP des baux DHCP. Il est possible de consulter cette table de correspondance via la commande : show ip dhcp snooping binding La fonctionnalit\u00e9 dans Cisco IOS qui s'appuie sur la table de correspondance du DHCP Snooping pour \u00e9viter les attaques ARP est le DAI, Dynamic ARP Inspection . Description du proc\u00e9d\u00e9, les adresses MAC et les adresses IP sont analys\u00e9s dans toutes les trames : Cas 1, La correspondance est r\u00e9f\u00e9renc\u00e9 dans la table DHCP Snooping => le switch forward la trame, Cas 2, La correspondance n'est pas r\u00e9f\u00e9renc\u00e9 dans la table DHCP Snooping mais elle \u00e0 \u00e9t\u00e9 d\u00e9finis dans une entr\u00e9e statique => le switch forward la trame, Cas 3, La correspondance n'est pas r\u00e9f\u00e9renc\u00e9 dans la table DHCP Snooping et elle n'est pas d\u00e9finis comme une entr\u00e9e statique => le switch drop la trame, 2.1 D\u00e9finir les IP statiques : Dans le laboratoire, le serveur DHCP est d\u00e9fini en configuration IP statique. Son association adresse MAC adresse IP n'est pas connu par la fonction DHCP Snooping du switch. Il est donc n\u00e9cessaire de trust le serveur DHCP . Pour cela deux possibilit\u00e9s : M\u00e9thode 1, trust du port du serveur DHCP, M\u00e9thode 2, trust de l'association adresse MAC et adresse IP, M\u00e9thode 1, trust du port du serveur DHCP par le DHCP snooping : SW-1(config)# interface GigabitEthernet 3/1 SW-1(config-if)# ip arp inspection trust M\u00e9thode 2, trust de l'association adresse MAC et adresse IP du serveur DHCP : SW-1(config)# access-list ARP-TRUST SW-1(config-nacl)# permit ip 192.168.10.31 mac 00:0C:29:07:DB:B1 SW-1(config-nacl)# exit SW-1(config)# ip arp inspection filter ARP-TRUST vlan 1 La premi\u00e8re m\u00e9thode est plus facile \u00e0 utiliser, mais moins s\u00e9curis\u00e9, elle n'emp\u00eachera pas une attaque ARP mais elle fera juste confiance au port. Tandis que la seconde m\u00e9thode accepte uniquement une association adresse IP et MAC. Je recommande d'utiliser la seconde m\u00e9thode. 2.1 Mise en place du DAI : Pour mettre en place DAI (se base sur la table DHCP Snooping) : SW-1(config)# ip arp inspection vlan 1 2.2 Tentative d'attaque : Depuis KALI , je vais tenter d'empoisonner la table ARP de PC-1 pour me faire passer pour PC-2 , la table ARP de PC-1 est actuellement vide. Pour rappel : PC-1 : 00:50:79:66:68:00, 192.168.10.118 PC-2 : 00:50:79:66:68:01, 192.168.10.120 KALI : 00:0C:29:05:A1:31, 192.168.10.104 Depuis la VM KALI : arpspoof -t 192.168.10.118 192.168.10.120 Traduction litt\u00e9rale : Aupr\u00e8s de PC-1 (192.168.10.118), fait moi passer pour PC-2 (192.168.10.120). Sur le poste, le cache ARP est vide : PC-1> show arp Illustration 9 : Cache ARP de la victime. Mais depuis le switch SW-1, il est possible d'observer ces lignes de logs : Illustration 10 : Ligne de log depuis SW-1 dans la console. Le switch SW-1 \u00e0 d\u00e9tect\u00e9 que la VM KALI envoie des r\u00e9ponses ARP falsifi\u00e9s car l'association adresse MAC et adresse IP n'est pas pr\u00e9sente : Dans le cache DHCP snooping , Dans une ACL ou dans un trust de port, Ce qui \u00e0 pour cons\u00e9quence que le switch SW-1 drop les trames de ma VM KALI . 3 Conclusion : Pour conclure sur la s\u00e9curit\u00e9 des protocoles DHCP et ARP : Attaque DHCP Starvation -> Port Security, Attaque DHCP Spoofing -> DHCP Snooping, Attaque ARP Spoofing -> DAI avec DHCP Snooping,","title":"S\u00e9curiser - ARP et DHCP :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#securiser-arp-et-dhcp","text":"Ressources : DHCP, https://formip.com/dhcp-snooping/ DHCP, https://medium.com/@ayushir/dhcp-snooping-attack-ca728e4dd84 ARP, https://formip.com/dai/","title":"S\u00e9curiser - ARP et DHCP :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#0-le-laboratoire","text":"Voici le laboratoire que j'utilise pour tester la s\u00e9curit\u00e9 des protocoles DHCP et ARP : Illustration 1 : Plan r\u00e9seau du laboratoire. Adressage IP et MAC : PC-1, DHCP, 00:50:79:66:68:00 PC-2, DHCP, 00:50:79:66:68:01 DHCP, 192.168.10.31/24, 00:0C:29:07:DB:B1 KALI, DHCP, 00:0C:29:05:A1:31 SW-1, 192.168.10.1/24 Tous les h\u00f4tes du laboratoire sont dans le VLAN 1. Configuration du serveur DHCP : option domain-name \"example.org\"; option domain-name-servers ns1.example.org, ns2.example.org; default-lease-time 600; max-lease-time 7200; subnet 192.168.10.0 netmask 255.255.255.0 { range 192.168.10.100 192.168.10.120; option subnet-mask 255.255.255.0; option broadcast-address 192.168.10.255; }","title":"0 Le laboratoire :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#1-securiser-le-protocole-dhcp","text":"Les attaques sur le protocole DHCP : DHCP Starvation, reserver tous les baux du serveur DHCP. Ce qui \u00e0 pour cons\u00e9quence que les clients n'obtiennent plus de configuration IP. DHCP Spoofing, un attaquant distribue des configuration IP o\u00f9 il se d\u00e9finit en tant que passerelle. Ce qui permet de r\u00e9aliser un MITM,","title":"1 S\u00e9curiser le protocole DHCP :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#11-miitigation","text":"","title":"1.1 Miitigation :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#111-dhcp-snooping","text":"Mise en place du DHCP snooping sur le VLAN 1 : SW-1(config)# ip dhcp snooping SW-1(config)# ip dhcp snooping vlan 1 SW-1(config)# no ip dhcp snooping information option D\u00e9tail des commandes : 1 Activation du DHCP Snooping globalement, 2 Activation du DHCP Snooping sur le VLAN 1, \u00e9tape n\u00e9cessaire sans celle-ci le DHCP snooping n'est pas fonctionnel, 3 L'activation globale du DHCP snooping active l'option DHCP 82, Option 82 d\u00e9finition : Cette option sp\u00e9cifie le r\u00e9seau source de la demande, dans une architecture r\u00e9seau ou le serveur DHCP se trouve dans un sous-r\u00e9seau diff\u00e9rent. La trame est relay\u00e9e par le routeur via l'agent relai. Dans ce contexte, un switch ou un routeur peut ajouter dans l'option 82 le r\u00e9seau source de la demande DHCP. Certains serveurs DHCP n'acceptent pas l'option 82, il peut \u00eatre n\u00e9cessaire de la d\u00e9sactiver. Trust du port GigabitEthernet 3/1 du switch SW-1 ou le serveur DHCP est connect\u00e9 : SW-1(config)# interface GigabitEthernet 3/1 SW-1(config-if)# ip dhcp snooping trust SW-1(config-if)# ip dhcp snooping limit rate 80 D\u00e9tail des commandes : * * 1 S\u00e9lection de l'interface, * 2 Trust de l'interface * 3 Mise en place d'un quota, dans l'exemple ce port est limit\u00e9 \u00e0 80 requ\u00eates DHCP/secondes.","title":"1.1.1 DHCP Snooping :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#112-port-security","text":"Le port-security limite le nombre d'adresses MAC r\u00e9f\u00e9renc\u00e9 sur un port. Ce qui \u00e0 pour cons\u00e9quence direct de mitiguer l'attaque DHCP Starvation Sur le switch SW-1 sur le port de PC-1 : SW-1(config)# interface GigabitEthernet 1/1 SW-1(config-if)# switchport mode access SW-1(config-if)# switchport port-security SW-1(config-if)# switchport port-security max 3 SW-1(config-if)# switchport port-security violation shutdown SW-1(config-if)# exit Sur le switch SW-1 sur le port de PC-2 : SW-1(config)# interface GigabitEthernet 1/2 SW-1(config-if)# switchport mode access SW-1(config-if)# switchport port-security max 3 SW-1(config-if)# switchport port-security violation shutdown SW-1(config-if)# exit Sur le switch SW-1 sur le port de KALI : SW-1(config)# interface GigabitEthernet 2/1 SW-1(config-if)# switchport mode access SW-1(config-if)# switchport port-security max 3 SW-1(config-if)# switchport port-security violation shutdown SW-1(config-if)# exit S'il y a plus de trois adresse MAC associ\u00e9 \u00e0 un port dans la table CAM du switch SW-1 , le port en question est \u00e9teint (shutdown). Cette limitation permet de \"voler\" au maximum trois baux par le pirate.","title":"1.1.2 Port Security :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#12-verification","text":"","title":"1.2 V\u00e9rification :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#121-verification-dhcp-snooping","text":"Commandes pour v\u00e9rifier le DHCP Snooping : SW-1# show ip dhcp snooping Illustration 2 : V\u00e9rification des ports trusts. Il est possible de noter : L'option 82 est d\u00e9sactiv\u00e9, L'interface GigabitEthernet 3/1 est une interface trust par le switch SW-1 pour les trames DHCP, Commandes pour voir les baux DHCP distribu\u00e9s (table DHCP Snooping) : SW-1# show ip dhcp snooping binding Illustration 3 : V\u00e9rification des baux DHCP. Dans cette capture, il est possible de voir que le DHCP \u00e0 distribu\u00e9 trois baux DHCP, on y retrouve : L'adresse MAC du client, L'adresse IP distribu\u00e9e par le DHCP, Lease time du bail DHCP, L'interface du client, Il est possible de clear la table DHCP Snooping : SW-1# clear ip dhcp snooping binding *","title":"1.2.1 V\u00e9rification DHCP Snooping :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#121-verification-port-security","text":"Voir les ports d\u00e9finis en tant que port security : SW-1# show port-security Illustration 4 : Port security configuration initiale. Nous pouvons remarquer que le port security permet \u00e0 chaque port, trois adresses MAC diff\u00e9rentes au maximum. Une adresse MAC est d\u00e9ja utilis\u00e9 sur chaque port il en reste donc deux de disponible.","title":"1.2.1 V\u00e9rification Port Security :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#13-tentative-dattaque","text":"","title":"1.3 Tentative d'attaque :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#131-dhcp-starvation","text":"Pour rappel le port security est actif est configurer pour autoriser trois adresses MAC diff\u00e9rentes sur chaque port du switch SW-1. Utilisation de yersinia , depuis la VM KALI : yersinia -G Se rendre dans : onglet DHCP -> DHCP Starvation -> OK Apr\u00e8s un cours instant, la VM KALI r\u00e9alise un nombre infini de requ\u00eate DHCP Discover dans l'objectif d'utiliser tous les baux DHCP du serveur DHCP. Mais le port security limite \u00e0 un maximum de trois adresses MAC sur le port ou est connect\u00e9 KALI (donc trois demandes DHCP Discover). Ce qui \u00e0 pour cons\u00e9quence de placer le port en mode err-disabled et de le rendre inutilisable. Aper\u00e7u : SW-1# show port-security SW-1# show interface status Illustration 5 : Status du port security apr\u00e8s l'attaque. Illustration 6 : Port d\u00e9sactiv\u00e9 zpar le DHCP snooping. Pour rendre ce port \u00e0 nouveau fonctionnel : SW-1(config)# interface GigabitEthernet 2/1 SW-1(config-if)# shutdown SW-1(config-if)# no shutdown","title":"1.3.1 DHCP Starvation :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#132-dhcp-spoofing","text":"Pour rappel seul le port vers le serveur DHCP GigabitEthernet 3/1 est trust pour les trames DHCP Offer. Utilisation de ethercap, depuis la VM KALI : ettercap -G Afin d'obtenir de meilleurs r\u00e9sultats, j'arr\u00eate le service DHCP du serveur DHCP : /etc/init.d/isc-dhcp-server stop Malgr\u00e9 que la VM KALI distribue des baux DHCP, aucun poste obtient une configuration IP. Mais si je place l'interface de la VM KALI en mode DHCP Snooping trust : SW-1(config)# interface GigabitEthernet 2/1 SW-1(config-if)# ip dhcp snooping trust Et que je renouvelle les demande DHCP de PC-1 et PC-2 : PC-1> ip dhcp PC-2> ip dhcp Les postes obtiennent une configuration IP. Depuis Ethercap : Illustration 7 : Log d'ethercap. Configuration IP des postes : PC-1> show ip Illustration 8 : Bail DHCP des postes. Nous pouvons remarquer que la valeur de la passerelle des configurations IP des postes correspond \u00e0 l'adresse IP de la VM KALI . Cette action a uniquement \u00e9t\u00e9 possible car j'ai plac\u00e9 le port de la VM KALI en mode DHCP Snooping trust . Sans cette modifications, les postes n'auraient jamais pu obtenir un bail DHCP.","title":"1.3.2 DHCP Spoofing :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#2-securiser-le-protocole-arp","text":"Pour s\u00e9curiser le protocole ARP, il est possible de s'appuyer sur la fonctionnalit\u00e9 DHCP snooping . En effet, le DHCP Snooping construit une table de correspondance qui r\u00e9f\u00e9rence l'adresse MAC et l'adresse IP des baux DHCP. Il est possible de consulter cette table de correspondance via la commande : show ip dhcp snooping binding La fonctionnalit\u00e9 dans Cisco IOS qui s'appuie sur la table de correspondance du DHCP Snooping pour \u00e9viter les attaques ARP est le DAI, Dynamic ARP Inspection . Description du proc\u00e9d\u00e9, les adresses MAC et les adresses IP sont analys\u00e9s dans toutes les trames : Cas 1, La correspondance est r\u00e9f\u00e9renc\u00e9 dans la table DHCP Snooping => le switch forward la trame, Cas 2, La correspondance n'est pas r\u00e9f\u00e9renc\u00e9 dans la table DHCP Snooping mais elle \u00e0 \u00e9t\u00e9 d\u00e9finis dans une entr\u00e9e statique => le switch forward la trame, Cas 3, La correspondance n'est pas r\u00e9f\u00e9renc\u00e9 dans la table DHCP Snooping et elle n'est pas d\u00e9finis comme une entr\u00e9e statique => le switch drop la trame,","title":"2 S\u00e9curiser le protocole ARP :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#21-definir-les-ip-statiques","text":"Dans le laboratoire, le serveur DHCP est d\u00e9fini en configuration IP statique. Son association adresse MAC adresse IP n'est pas connu par la fonction DHCP Snooping du switch. Il est donc n\u00e9cessaire de trust le serveur DHCP . Pour cela deux possibilit\u00e9s : M\u00e9thode 1, trust du port du serveur DHCP, M\u00e9thode 2, trust de l'association adresse MAC et adresse IP, M\u00e9thode 1, trust du port du serveur DHCP par le DHCP snooping : SW-1(config)# interface GigabitEthernet 3/1 SW-1(config-if)# ip arp inspection trust M\u00e9thode 2, trust de l'association adresse MAC et adresse IP du serveur DHCP : SW-1(config)# access-list ARP-TRUST SW-1(config-nacl)# permit ip 192.168.10.31 mac 00:0C:29:07:DB:B1 SW-1(config-nacl)# exit SW-1(config)# ip arp inspection filter ARP-TRUST vlan 1 La premi\u00e8re m\u00e9thode est plus facile \u00e0 utiliser, mais moins s\u00e9curis\u00e9, elle n'emp\u00eachera pas une attaque ARP mais elle fera juste confiance au port. Tandis que la seconde m\u00e9thode accepte uniquement une association adresse IP et MAC. Je recommande d'utiliser la seconde m\u00e9thode.","title":"2.1 D\u00e9finir les IP statiques :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#21-mise-en-place-du-dai","text":"Pour mettre en place DAI (se base sur la table DHCP Snooping) : SW-1(config)# ip arp inspection vlan 1","title":"2.1 Mise en place du DAI :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#22-tentative-dattaque","text":"Depuis KALI , je vais tenter d'empoisonner la table ARP de PC-1 pour me faire passer pour PC-2 , la table ARP de PC-1 est actuellement vide. Pour rappel : PC-1 : 00:50:79:66:68:00, 192.168.10.118 PC-2 : 00:50:79:66:68:01, 192.168.10.120 KALI : 00:0C:29:05:A1:31, 192.168.10.104 Depuis la VM KALI : arpspoof -t 192.168.10.118 192.168.10.120 Traduction litt\u00e9rale : Aupr\u00e8s de PC-1 (192.168.10.118), fait moi passer pour PC-2 (192.168.10.120). Sur le poste, le cache ARP est vide : PC-1> show arp Illustration 9 : Cache ARP de la victime. Mais depuis le switch SW-1, il est possible d'observer ces lignes de logs : Illustration 10 : Ligne de log depuis SW-1 dans la console. Le switch SW-1 \u00e0 d\u00e9tect\u00e9 que la VM KALI envoie des r\u00e9ponses ARP falsifi\u00e9s car l'association adresse MAC et adresse IP n'est pas pr\u00e9sente : Dans le cache DHCP snooping , Dans une ACL ou dans un trust de port, Ce qui \u00e0 pour cons\u00e9quence que le switch SW-1 drop les trames de ma VM KALI .","title":"2.2 Tentative d'attaque :"},{"location":"Cisco/S%C3%A9curiser%20ARP%20et%20DHCP/#3-conclusion","text":"Pour conclure sur la s\u00e9curit\u00e9 des protocoles DHCP et ARP : Attaque DHCP Starvation -> Port Security, Attaque DHCP Spoofing -> DHCP Snooping, Attaque ARP Spoofing -> DAI avec DHCP Snooping,","title":"3 Conclusion :"},{"location":"Cisco/S%C3%A9curiser%20VLAN/","text":"S\u00e9curiser - Les VLAN : Ressource : https://cybersecurity.att.com/blogs/security-essentials/vlan-hopping-and-mitigation https://www.notsosecure.com/exploiting-vlan-double-tagging/ https://networklessons.com/cisco/ccnp-switch/vlan-hopping Cette documentation illustre les m\u00e9thodes pour mitiguer les attaques de rebonds des VLAN. Il existe deux m\u00e9thodes pour r\u00e9aliser cette attaque : Double tag, Protocole DTP, 1 Le double tag : 1.1 Le laboratoire : Voici le laboratoire que j'utilise pour ce lab : Illustration 1 : Plan r\u00e9seau du laboratoire. Ce lab est composer d'un VLAN : VLAN 10 ; 192.168.10.0/24 Le PC-1 se rouve dans le VLAN 10 et l'attaquant dajns le VLAN 1 (par d\u00e9faut). Une liason trunk est entre le switch SW-1 et le dwitch SW-2. Script de configuration du switch SW-1 : SW-1(config)# vlan 1 SW-1(config-vlan)# no shutdown SW-1(config-vlan)# exit SW-1(config)# vlan 10 SW-1(config-vlan)# name vlan_1 SW-1(config-vlan)# no shutdown SW-1(config-vlan)# exit SW-1(config)# interface vlan 10 SW-1(config-if)# ip address 192.168.10.10 255.255.255.0 SW-1(config-if)#no shutdown SW-1(config-if)# exit SW-1(config)# interface GigabitEthernet0/0 SW-1(config-if)# switchport mode access SW-1(config-if)# switchport access vlan 10 SW-1(config-if)# no shutdown SW-1(config-if)# exit SW-1(config)# interface GigabitEthernet3/0 SW-1(config-if)# switchport trunk encapsulation dot1q SW-1(config-if)# switchport mode trunk SW-1(config-if)# switchport trunk allowed vlan all SW-1(config-if)# switchport trunk native vlan 1 SW-1(config-if)# no shutdown SW-1(config-if)# exit SW-1(config)# hostname SW-1 SW-1(config)# do wr Script de configuration du switch SW-2 : SW-2(config)# vlan 1 SW-2(config-vlan)# no shutdown SW-2(config-vlan)# exit SW-2(config)# vlan 10 SW-2(config-vlan)# name vlan_1 SW-2(config-vlan)# no shutdown SW-2(config-vlan)# exit SW-2(config)# interface vlan 10 SW-2(config-if)# ip address 192.168.10.20 255.255.255.0 SW-2(config-if)# no shutdown SW-2(config-if)# exit SW-2(config)# interface GigabitEthernet0/0 SW-2(config-if)# switchport mode access SW-2(config-if)# switchport access vlan 1 SW-2(config-if)# no shutdown SW-2(config-if)# exit SW-2(config)# interface GigabitEthernet3/0 SW-2(config-if)# switchport trunk encapsulation dot1q SW-2(config-if)# switchport mode trunk SW-2(config-if)# switchport trunk allowed vlan all SW-2(config-if)# switchport trunk native vlan 1 SW-2(config-if)# no shutdown SW-2(config-if)# exit SW-2(config)# hostname SW-2 SW-2(config)# do wr 1.2 Explications : Cette attaque est possible uniquement quand une liason trunk est configur\u00e9 entre deux switch. Pour rappel la norme dot1q ajoute un champ dans les trames ethernet, ce champ specifie le num\u00e9ros du vlan qui est associ\u00e9 \u00e0 la trame. L'objectif de cette action est de diffus\u00e9 uniquement la trame au vlan associ\u00e9. Par exemple une trame de demande ARP est \u00e9mise par un poste elle est diffus\u00e9 dans le VLAN 10 : 1 Le switch regarde les ports qui sont positionn\u00e9 dans le VLAN 10 et transmet la trame, 2 Ensuite le switch ajoute un champ VLAN_ID dans la trame ethernet qui correspond au num\u00e9ros de VLAN (VLAN 10), 3 Le switch transmet cette trame au second switch, 4 Le second switch ouvre la trame r\u00e9cup\u00e8re la valeur de VLAN_ID, 5 Et il transmet la trame aux ports configur\u00e9s dans le VLAN 10, Dans ce contexte, le poste envoie au switch (avant l'\u00e9tape 1) une trame doublement entagu\u00e9e : Illustration 2 : Trame double tag. L'attaquant envoie une trame avec deux balise 802.1Q : La balise interne correspond au vlan natif, La balise externe correspond au vlan que l'attaquant souhaite contacter, Le switch re\u00e7oit cette trame et il effectue les actions suivantes : 1 Supprime la premi\u00e8re ent\u00eate 802.1Q (vlan natif), 2 Il relais la trame \u00e0 l'ID de vlan de la seconde ent\u00eate, D\u00e9finition VLAN natif : Certaines trames v\u00e9hicul\u00e9es sur un trunk ne sont pas marqu\u00e9es d\u2019un tag dot1q. D\u00e9s lors il faut pouvoir les placer quelque part. C\u2019est l\u00e0 qu\u2019intervient le vlan natif. Le vlan natif, est le vlan dans lequel sont v\u00e9hicul\u00e9es les trames non tagu\u00e9es dot1q. Donc si un switch re\u00e7oit sur une interface trunk une trame ethernet standard, il la placera dans ce vlan natif, en quelque sorte, un vlan par d\u00e9faut (de marquage). Sur les \u00e9quipements Cisco, certains protocoles comme CDP ou DTP sont v\u00e9hicul\u00e9s dans des trames non tagu\u00e9es et donc dans le vlan natif. Le vlan natif est utilis\u00e9 lorsqu'un port configur\u00e9 en trunk re\u00e7oit une trame non tagu\u00e9e. Lorsqu'un port trunk re\u00e7oit une trame non tagu\u00e9e il l'envoie dans le vlan natif. Par d\u00e9faut le vlan natif est le vlan 1 sur les witchs Cisco. L'attaque de double tag est unidirectionnel l'attaquant peux envoyer des trames mais il n'obtiendra pas de r\u00e9ponse. Ce qui permet par exemple de r\u00e9aliser un DoS. 1.3 Attaque : A l'aide de scapy l'attaquant envoie ce paquet : scapy sendp(Ether(dst='ff:ff:ff:ff:ff:ff', src='0E:5C:49:19:32:BF')/Dot1Q(vlan=1)/Dot1Q(vlan=20)/IP(dst='255.255.255.255', src='192.168.10.1')/ICMP(), iface='eth0') 1.4 Mitigation : Pour mitiger l'attaque double tagged il faut changer la valeur du vlan natif celui doit correspondre \u00e0 deux crit\u00e8res : D\u00e9di\u00e9 un vlan uniquement \u00e0 cet usage, Le VLAN natif doit \u00eatre identique entre les liasons trunk, Mitigations sur SW-1 : SW-1(config)# vlan 99 SW-1(config-vlan)# name natif SW-1(config-vlan)# no shutdown SW-1(config-vlan)# exit SW-1(config)# interface GigabitEthernet 3/0 SW-1(config-if)# switchport trunk native vlan 99 SW-1(config-if)# exit Mitigations sur SW-2 : SW-2(config)# vlan 99 SW-2(config-vlan)# name natif SW-2(config-vlan)# no shutdown SW-2(config-vlan)# exit SW-2(config)# interface GigabitEthernet 3/0 SW-2(config-if)# switchport trunk native vlan 99 SW-2(config-if)# exit 2 Le protocole DTP : 2.1 Le laboratoire : Voici le laboratoire que j'utilise pour ce lab : Illustration 3 : Plan du laboratoire. Voici le script de configuration du switch SW-1 : SW-2(config)# interface GigabitEthernet0/0 SW-2(config-if)# switchport mode dynamic auto SW-2(config-if)# exit SW-2(config)# hostname SW-1 SW-2(config)# do wr 2.2 Explications : Le protocole DTP (Dynamic Trunk Protocol) est un protocole propri\u00e9taire Cisco qui permet de n\u00e9gocier les liason trunk avec d'autres \u00e9quipement Cisco. Par d\u00e9faut il est activ\u00e9 et il permet \u00e0 un attaquant de monter une liason trunk entreson PC et le switch. Ce qui \u00e0 pour cons\u00e9quence qu'il peut d\u00e9tourner tous les vlan configur\u00e9s sur le switch. Il existe plusieurs mode DTP : Illustration 4 : Mode DTP. Et ces mode m\u00e8nent \u00e0 plusieurs r\u00e9sultats : Illustration 5 : Association des modes DTP. 2.3 Attaque : Aparavant, je m'assure qu'aucun port et \u00e0 monter une liason trunk : SW-1# show interface trunk Aucun retour donc aucune interfac n'a \u00e9t\u00e9 mont\u00e9 en trunk. Ensuite avec yersinia : yersinia -G Je me rend dans DTP -> Launc attack -> Enabling trunking -> OK Je retourne sur le switch : SW-1# show interface trunk Illustration 6 : Port de cascade. L'interface de l'attaquant est mont\u00e9 en trunk. 2.4 Mitigation : Il faut d\u00e9sactiver le protocle DTP vers tous les postes clients : SW-1(config)# interface <toutes-les-interfaces-vers-les-clients> SW-1(config-if)# switchport mode access SW-1(config-if)# switchport nonegotiate Je recommande de privilig\u00e9 de d\u00e9sactiver DTP sur les ports de cascades et de monter manuellement les liasons trunk. 3 Conclusion : Nous avons vu deux attaques sur les vlan : Double tagging Switch spoof Pour mitiguer ces deux attaques : * Changer la valeur du vlan natif et ne pas laisser de ports de clients dans un vlan qui n'est pas d\u00e9finis en access sur un vlan pr\u00e9cis, * D\u00e9sactiver le protocole DTP sur tous les ports","title":"S\u00e9curiser - Les VLAN :"},{"location":"Cisco/S%C3%A9curiser%20VLAN/#securiser-les-vlan","text":"Ressource : https://cybersecurity.att.com/blogs/security-essentials/vlan-hopping-and-mitigation https://www.notsosecure.com/exploiting-vlan-double-tagging/ https://networklessons.com/cisco/ccnp-switch/vlan-hopping Cette documentation illustre les m\u00e9thodes pour mitiguer les attaques de rebonds des VLAN. Il existe deux m\u00e9thodes pour r\u00e9aliser cette attaque : Double tag, Protocole DTP,","title":"S\u00e9curiser - Les VLAN :"},{"location":"Cisco/S%C3%A9curiser%20VLAN/#1-le-double-tag","text":"","title":"1 Le double tag :"},{"location":"Cisco/S%C3%A9curiser%20VLAN/#11-le-laboratoire","text":"Voici le laboratoire que j'utilise pour ce lab : Illustration 1 : Plan r\u00e9seau du laboratoire. Ce lab est composer d'un VLAN : VLAN 10 ; 192.168.10.0/24 Le PC-1 se rouve dans le VLAN 10 et l'attaquant dajns le VLAN 1 (par d\u00e9faut). Une liason trunk est entre le switch SW-1 et le dwitch SW-2. Script de configuration du switch SW-1 : SW-1(config)# vlan 1 SW-1(config-vlan)# no shutdown SW-1(config-vlan)# exit SW-1(config)# vlan 10 SW-1(config-vlan)# name vlan_1 SW-1(config-vlan)# no shutdown SW-1(config-vlan)# exit SW-1(config)# interface vlan 10 SW-1(config-if)# ip address 192.168.10.10 255.255.255.0 SW-1(config-if)#no shutdown SW-1(config-if)# exit SW-1(config)# interface GigabitEthernet0/0 SW-1(config-if)# switchport mode access SW-1(config-if)# switchport access vlan 10 SW-1(config-if)# no shutdown SW-1(config-if)# exit SW-1(config)# interface GigabitEthernet3/0 SW-1(config-if)# switchport trunk encapsulation dot1q SW-1(config-if)# switchport mode trunk SW-1(config-if)# switchport trunk allowed vlan all SW-1(config-if)# switchport trunk native vlan 1 SW-1(config-if)# no shutdown SW-1(config-if)# exit SW-1(config)# hostname SW-1 SW-1(config)# do wr Script de configuration du switch SW-2 : SW-2(config)# vlan 1 SW-2(config-vlan)# no shutdown SW-2(config-vlan)# exit SW-2(config)# vlan 10 SW-2(config-vlan)# name vlan_1 SW-2(config-vlan)# no shutdown SW-2(config-vlan)# exit SW-2(config)# interface vlan 10 SW-2(config-if)# ip address 192.168.10.20 255.255.255.0 SW-2(config-if)# no shutdown SW-2(config-if)# exit SW-2(config)# interface GigabitEthernet0/0 SW-2(config-if)# switchport mode access SW-2(config-if)# switchport access vlan 1 SW-2(config-if)# no shutdown SW-2(config-if)# exit SW-2(config)# interface GigabitEthernet3/0 SW-2(config-if)# switchport trunk encapsulation dot1q SW-2(config-if)# switchport mode trunk SW-2(config-if)# switchport trunk allowed vlan all SW-2(config-if)# switchport trunk native vlan 1 SW-2(config-if)# no shutdown SW-2(config-if)# exit SW-2(config)# hostname SW-2 SW-2(config)# do wr","title":"1.1 Le laboratoire :"},{"location":"Cisco/S%C3%A9curiser%20VLAN/#12-explications","text":"Cette attaque est possible uniquement quand une liason trunk est configur\u00e9 entre deux switch. Pour rappel la norme dot1q ajoute un champ dans les trames ethernet, ce champ specifie le num\u00e9ros du vlan qui est associ\u00e9 \u00e0 la trame. L'objectif de cette action est de diffus\u00e9 uniquement la trame au vlan associ\u00e9. Par exemple une trame de demande ARP est \u00e9mise par un poste elle est diffus\u00e9 dans le VLAN 10 : 1 Le switch regarde les ports qui sont positionn\u00e9 dans le VLAN 10 et transmet la trame, 2 Ensuite le switch ajoute un champ VLAN_ID dans la trame ethernet qui correspond au num\u00e9ros de VLAN (VLAN 10), 3 Le switch transmet cette trame au second switch, 4 Le second switch ouvre la trame r\u00e9cup\u00e8re la valeur de VLAN_ID, 5 Et il transmet la trame aux ports configur\u00e9s dans le VLAN 10, Dans ce contexte, le poste envoie au switch (avant l'\u00e9tape 1) une trame doublement entagu\u00e9e : Illustration 2 : Trame double tag. L'attaquant envoie une trame avec deux balise 802.1Q : La balise interne correspond au vlan natif, La balise externe correspond au vlan que l'attaquant souhaite contacter, Le switch re\u00e7oit cette trame et il effectue les actions suivantes : 1 Supprime la premi\u00e8re ent\u00eate 802.1Q (vlan natif), 2 Il relais la trame \u00e0 l'ID de vlan de la seconde ent\u00eate, D\u00e9finition VLAN natif : Certaines trames v\u00e9hicul\u00e9es sur un trunk ne sont pas marqu\u00e9es d\u2019un tag dot1q. D\u00e9s lors il faut pouvoir les placer quelque part. C\u2019est l\u00e0 qu\u2019intervient le vlan natif. Le vlan natif, est le vlan dans lequel sont v\u00e9hicul\u00e9es les trames non tagu\u00e9es dot1q. Donc si un switch re\u00e7oit sur une interface trunk une trame ethernet standard, il la placera dans ce vlan natif, en quelque sorte, un vlan par d\u00e9faut (de marquage). Sur les \u00e9quipements Cisco, certains protocoles comme CDP ou DTP sont v\u00e9hicul\u00e9s dans des trames non tagu\u00e9es et donc dans le vlan natif. Le vlan natif est utilis\u00e9 lorsqu'un port configur\u00e9 en trunk re\u00e7oit une trame non tagu\u00e9e. Lorsqu'un port trunk re\u00e7oit une trame non tagu\u00e9e il l'envoie dans le vlan natif. Par d\u00e9faut le vlan natif est le vlan 1 sur les witchs Cisco. L'attaque de double tag est unidirectionnel l'attaquant peux envoyer des trames mais il n'obtiendra pas de r\u00e9ponse. Ce qui permet par exemple de r\u00e9aliser un DoS.","title":"1.2 Explications :"},{"location":"Cisco/S%C3%A9curiser%20VLAN/#13-attaque","text":"A l'aide de scapy l'attaquant envoie ce paquet : scapy sendp(Ether(dst='ff:ff:ff:ff:ff:ff', src='0E:5C:49:19:32:BF')/Dot1Q(vlan=1)/Dot1Q(vlan=20)/IP(dst='255.255.255.255', src='192.168.10.1')/ICMP(), iface='eth0')","title":"1.3 Attaque :"},{"location":"Cisco/S%C3%A9curiser%20VLAN/#14-mitigation","text":"Pour mitiger l'attaque double tagged il faut changer la valeur du vlan natif celui doit correspondre \u00e0 deux crit\u00e8res : D\u00e9di\u00e9 un vlan uniquement \u00e0 cet usage, Le VLAN natif doit \u00eatre identique entre les liasons trunk, Mitigations sur SW-1 : SW-1(config)# vlan 99 SW-1(config-vlan)# name natif SW-1(config-vlan)# no shutdown SW-1(config-vlan)# exit SW-1(config)# interface GigabitEthernet 3/0 SW-1(config-if)# switchport trunk native vlan 99 SW-1(config-if)# exit Mitigations sur SW-2 : SW-2(config)# vlan 99 SW-2(config-vlan)# name natif SW-2(config-vlan)# no shutdown SW-2(config-vlan)# exit SW-2(config)# interface GigabitEthernet 3/0 SW-2(config-if)# switchport trunk native vlan 99 SW-2(config-if)# exit","title":"1.4 Mitigation :"},{"location":"Cisco/S%C3%A9curiser%20VLAN/#2-le-protocole-dtp","text":"","title":"2 Le protocole DTP :"},{"location":"Cisco/S%C3%A9curiser%20VLAN/#21-le-laboratoire","text":"Voici le laboratoire que j'utilise pour ce lab : Illustration 3 : Plan du laboratoire. Voici le script de configuration du switch SW-1 : SW-2(config)# interface GigabitEthernet0/0 SW-2(config-if)# switchport mode dynamic auto SW-2(config-if)# exit SW-2(config)# hostname SW-1 SW-2(config)# do wr","title":"2.1 Le laboratoire :"},{"location":"Cisco/S%C3%A9curiser%20VLAN/#22-explications","text":"Le protocole DTP (Dynamic Trunk Protocol) est un protocole propri\u00e9taire Cisco qui permet de n\u00e9gocier les liason trunk avec d'autres \u00e9quipement Cisco. Par d\u00e9faut il est activ\u00e9 et il permet \u00e0 un attaquant de monter une liason trunk entreson PC et le switch. Ce qui \u00e0 pour cons\u00e9quence qu'il peut d\u00e9tourner tous les vlan configur\u00e9s sur le switch. Il existe plusieurs mode DTP : Illustration 4 : Mode DTP. Et ces mode m\u00e8nent \u00e0 plusieurs r\u00e9sultats : Illustration 5 : Association des modes DTP.","title":"2.2 Explications :"},{"location":"Cisco/S%C3%A9curiser%20VLAN/#23-attaque","text":"Aparavant, je m'assure qu'aucun port et \u00e0 monter une liason trunk : SW-1# show interface trunk Aucun retour donc aucune interfac n'a \u00e9t\u00e9 mont\u00e9 en trunk. Ensuite avec yersinia : yersinia -G Je me rend dans DTP -> Launc attack -> Enabling trunking -> OK Je retourne sur le switch : SW-1# show interface trunk Illustration 6 : Port de cascade. L'interface de l'attaquant est mont\u00e9 en trunk.","title":"2.3 Attaque :"},{"location":"Cisco/S%C3%A9curiser%20VLAN/#24-mitigation","text":"Il faut d\u00e9sactiver le protocle DTP vers tous les postes clients : SW-1(config)# interface <toutes-les-interfaces-vers-les-clients> SW-1(config-if)# switchport mode access SW-1(config-if)# switchport nonegotiate Je recommande de privilig\u00e9 de d\u00e9sactiver DTP sur les ports de cascades et de monter manuellement les liasons trunk.","title":"2.4 Mitigation :"},{"location":"Cisco/S%C3%A9curiser%20VLAN/#3-conclusion","text":"Nous avons vu deux attaques sur les vlan : Double tagging Switch spoof Pour mitiguer ces deux attaques : * Changer la valeur du vlan natif et ne pas laisser de ports de clients dans un vlan qui n'est pas d\u00e9finis en access sur un vlan pr\u00e9cis, * D\u00e9sactiver le protocole DTP sur tous les ports","title":"3 Conclusion :"},{"location":"Cisco/S%C3%A9curiser%20les%20mots%20de%20passe/","text":"S\u00e9curiser - Les mots de passe sur Cisco : Ressource : https://cisco.goffinet.org/ccna/gestion-securisee-peripheriques/chiffrement-des-mots-de-passes-locaux-cisco-ios/ https://fr.wikipedia.org/wiki/Scrypt 0 Le laboratoire : Voici le laboratoire que j'utilise pour ce sujet : Illustration 1 : Plan r\u00e9seau du laboratoire. Il est possible de distinguer deux types d'acc\u00e8s aux \u00e9quipements Cisco : out-band ; acc\u00e8s par la console (ne n\u00e9cessite pas de configuration r\u00e9seau ; ex c\u00e2ble console, etc.), in-band ; acc\u00e8s par un service r\u00e9seau (n\u00e9cessite une configuration IP ; ex SSH, etc.), 1 Acc\u00e8s out-band : Pour d\u00e9finir un mot de passe pour l'acc\u00e8s \u00e0 la console de mani\u00e8re s\u00e9curis\u00e9, j'utilise l'algorithme scrypt. Par exemple avec le mot de passe test : SW-1(config)# enable algorithm-type scrypt secret test Le mot de passe est d\u00e9fini en type 9 tandis que le sha-256 est d\u00e9finis en type 8. Donc le scrypt apporte un gain de s\u00e9curit\u00e9. Lorsque l'on regarde la configuration : SW-1# sh run Illustration 2 : Mot de passe enable chiffr\u00e9. Nous pouvons constater que le mot de passe test est chiffr\u00e9 et de type 9. 2 Acc\u00e8s in-band : Pour avoir un acc\u00e8s in-band, il est n\u00e9cessaire de d\u00e9finir une une configuration IP sur le switch. 2.1 Activer SSH : Pr\u00e9requis : SW-1(config)# ip domain-name test.com SW-1(config)# crypto key generate rsa modulus 4096 1 D\u00e9finir un nom de domaine pour la paire de cl\u00e9, 2 G\u00e9n\u00e9rer la paire de cl\u00e9, Activer SSH : SW-1(config)# ip ssh version 2 SW-1(config)# line vty 0 15 SW-1(config-line)# login local SW-1(config-line)# transport input ssh SW-1(config-line)# exit 1 Activer le protocole SSH, 2 S\u00e9lectionner les terminaux virtuels 0 \u00e0 15, 3 Sp\u00e9cifier une authentification locale, 4 Sp\u00e9cifier que l'on utilise SSH sur ces terminaux, 2.2 Cr\u00e9er un administrateur : Cr\u00e9ation d'un administrateur admin avec le mot de passe test : SW-1(config)# username admin privilege 15 algorithm-type scrypt secret test D\u00e9tail des options : privilege 15, sp\u00e9cifie que cet utilisateur poss\u00e8de les droits administrateurs sur le switch, algorithme-type, permet de sp\u00e9cifier quel sea l'algorithme de chiffrement utilis\u00e9 pour chiffrer le mot de passe dans la configuration, Lorsque l'on regarde la configuration, on peut voir les deux mots de passe chiffr\u00e9s : Illustration 3 : Mots de passe chiffr\u00e9s. Les deux mots de passe sont de type 9 en scrypt. 3 Service de chiffrement des mots de passe : Au sein d'IOS, il existe une fonction qui chiffre les mots de passe qui sont d\u00e9j\u00e0 sp\u00e9cifi\u00e9 dans la configuration et les mots de passe qui seront sp\u00e9cifi\u00e9s dans le futur. Cette fonction s'appele password-encryption . Pour activer cette fonction : SW-1(config)# service password-encryption 4 Conclusion : Pour s\u00e9curiser l'acc\u00e8s \u00e0 un \u00e9quipement Cisco, il faut d\u00e9finir des mots de passe sur : L'acc\u00e8s \u00e0 la console, L'acc\u00e8s depuis un protocole distant, Ces mots de passe doivent \u00eatre chiffr\u00e9s dans la configuration \u00e0 l'aide de l'algorithme scrypt .","title":"S\u00e9curiser - Les mots de passe sur Cisco :"},{"location":"Cisco/S%C3%A9curiser%20les%20mots%20de%20passe/#securiser-les-mots-de-passe-sur-cisco","text":"Ressource : https://cisco.goffinet.org/ccna/gestion-securisee-peripheriques/chiffrement-des-mots-de-passes-locaux-cisco-ios/ https://fr.wikipedia.org/wiki/Scrypt","title":"S\u00e9curiser - Les mots de passe sur Cisco :"},{"location":"Cisco/S%C3%A9curiser%20les%20mots%20de%20passe/#0-le-laboratoire","text":"Voici le laboratoire que j'utilise pour ce sujet : Illustration 1 : Plan r\u00e9seau du laboratoire. Il est possible de distinguer deux types d'acc\u00e8s aux \u00e9quipements Cisco : out-band ; acc\u00e8s par la console (ne n\u00e9cessite pas de configuration r\u00e9seau ; ex c\u00e2ble console, etc.), in-band ; acc\u00e8s par un service r\u00e9seau (n\u00e9cessite une configuration IP ; ex SSH, etc.),","title":"0 Le laboratoire :"},{"location":"Cisco/S%C3%A9curiser%20les%20mots%20de%20passe/#1-acces-out-band","text":"Pour d\u00e9finir un mot de passe pour l'acc\u00e8s \u00e0 la console de mani\u00e8re s\u00e9curis\u00e9, j'utilise l'algorithme scrypt. Par exemple avec le mot de passe test : SW-1(config)# enable algorithm-type scrypt secret test Le mot de passe est d\u00e9fini en type 9 tandis que le sha-256 est d\u00e9finis en type 8. Donc le scrypt apporte un gain de s\u00e9curit\u00e9. Lorsque l'on regarde la configuration : SW-1# sh run Illustration 2 : Mot de passe enable chiffr\u00e9. Nous pouvons constater que le mot de passe test est chiffr\u00e9 et de type 9.","title":"1 Acc\u00e8s out-band :"},{"location":"Cisco/S%C3%A9curiser%20les%20mots%20de%20passe/#2-acces-in-band","text":"Pour avoir un acc\u00e8s in-band, il est n\u00e9cessaire de d\u00e9finir une une configuration IP sur le switch.","title":"2 Acc\u00e8s in-band :"},{"location":"Cisco/S%C3%A9curiser%20les%20mots%20de%20passe/#21-activer-ssh","text":"Pr\u00e9requis : SW-1(config)# ip domain-name test.com SW-1(config)# crypto key generate rsa modulus 4096 1 D\u00e9finir un nom de domaine pour la paire de cl\u00e9, 2 G\u00e9n\u00e9rer la paire de cl\u00e9, Activer SSH : SW-1(config)# ip ssh version 2 SW-1(config)# line vty 0 15 SW-1(config-line)# login local SW-1(config-line)# transport input ssh SW-1(config-line)# exit 1 Activer le protocole SSH, 2 S\u00e9lectionner les terminaux virtuels 0 \u00e0 15, 3 Sp\u00e9cifier une authentification locale, 4 Sp\u00e9cifier que l'on utilise SSH sur ces terminaux,","title":"2.1 Activer SSH :"},{"location":"Cisco/S%C3%A9curiser%20les%20mots%20de%20passe/#22-creer-un-administrateur","text":"Cr\u00e9ation d'un administrateur admin avec le mot de passe test : SW-1(config)# username admin privilege 15 algorithm-type scrypt secret test D\u00e9tail des options : privilege 15, sp\u00e9cifie que cet utilisateur poss\u00e8de les droits administrateurs sur le switch, algorithme-type, permet de sp\u00e9cifier quel sea l'algorithme de chiffrement utilis\u00e9 pour chiffrer le mot de passe dans la configuration, Lorsque l'on regarde la configuration, on peut voir les deux mots de passe chiffr\u00e9s : Illustration 3 : Mots de passe chiffr\u00e9s. Les deux mots de passe sont de type 9 en scrypt.","title":"2.2 Cr\u00e9er un administrateur :"},{"location":"Cisco/S%C3%A9curiser%20les%20mots%20de%20passe/#3-service-de-chiffrement-des-mots-de-passe","text":"Au sein d'IOS, il existe une fonction qui chiffre les mots de passe qui sont d\u00e9j\u00e0 sp\u00e9cifi\u00e9 dans la configuration et les mots de passe qui seront sp\u00e9cifi\u00e9s dans le futur. Cette fonction s'appele password-encryption . Pour activer cette fonction : SW-1(config)# service password-encryption","title":"3 Service de chiffrement des mots de passe :"},{"location":"Cisco/S%C3%A9curiser%20les%20mots%20de%20passe/#4-conclusion","text":"Pour s\u00e9curiser l'acc\u00e8s \u00e0 un \u00e9quipement Cisco, il faut d\u00e9finir des mots de passe sur : L'acc\u00e8s \u00e0 la console, L'acc\u00e8s depuis un protocole distant, Ces mots de passe doivent \u00eatre chiffr\u00e9s dans la configuration \u00e0 l'aide de l'algorithme scrypt .","title":"4 Conclusion :"}]}